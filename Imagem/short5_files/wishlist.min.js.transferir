"use strict";String.prototype.includes||(String.prototype.includes=function(t,e){if(t instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===e&&(e=0),this.indexOf(t,e)!==-1}),function(){var t,e=function(t,e){return new Promise(function(i,s){var r={method:"get",type:"html",data:e,success:function(t){i(t)},error:function(t){console.error("wishlist error: ",t),s(!1)}};window.freedom.restClient.request(t,r)})},i=function(t,i){if(t){var s={},r="/wishlist/delete/"+i,n=t&&t.parentNode?t.parentNode:null;document.querySelector(".floating-button")?document.querySelectorAll(".wishlist").forEach(function(t){t.classList.remove("heart-active"),t.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart-active"),t.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart")}):(n&&t.parentNode.classList.remove("heart-active"),t.querySelector("i").classList.remove("ns-icon-wishlist-heart-active"),t.querySelector("i").classList.add("ns-icon-wishlist-heart")),e(r,s).then()}},s=function(t,i){if(t){var s={},r="/wishlist/add/"+i,n=t&&t.parentNode?t.parentNode:null;document.querySelector(".floating-button")?document.querySelectorAll(".wishlist").forEach(function(t){t.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart"),t.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart-active"),t.classList.add("heart-active")}):(n&&n.classList.add("heart-active"),t.querySelector("i").classList.remove("ns-icon-wishlist-heart"),t.querySelector("i").classList.add("ns-icon-wishlist-heart-active")),e(r,s).then();var o=window.freedom.getCookie("uuid");if(o&&o.includes("anonymous")){var c=window.location.pathname+"?"+t.getAttribute("data-href");window.location="/login?redirect="+c}}},r=function(t){var i=t.getAttribute("data-code"),s={},r="/wishlist/"+i;e(r,s).then(function(e){"false"!==e&&(t.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart"),t.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart-active"))})},n=function(){var i={},s="/wishlist/all";e(s,i).then(function(e){t=JSON.parse(e)})},o=function(e){var i=e.getAttribute("data-code"),s=t.map(function(t){return t.code}).indexOf(i);s!==-1&&(e.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart"),e.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart-active"))},c=function(e){var i=e?e.querySelector(".wishlist__heart"):document.querySelectorAll(".wishlist__heart");if(e)var s=setInterval(function(){t&&(clearInterval(s),o(i))},1e3);else i.forEach(function(t){r(t)})};window.freedom.nsPubSub.sub("wishlist.checkFavoriteProducts",c);var a=function(){var t=this.getAttribute("data-code");this.querySelector("i").classList.contains("ns-icon-wishlist-heart-active")?i(this,t):s(this,t)},l=function(t){var e=document.querySelectorAll(".wishlist__heart");e.length>1?e.forEach(function(e){t&&e.removeEventListener("click",a),e.addEventListener("click",a)}):window.freedom.live(".wishlist__heart","click",function(){var t=this.getAttribute("data-code");this.querySelector("i").classList.contains("ns-icon-wishlist-heart-active")?i(this,t):s(this,t)})};window.freedom.nsPubSub.sub("wishlist.clickListener",l),function(){try{var t=document.querySelector(".wishlist .wishlist__heart");if(t&&"pdp"===t.getAttribute("data-template"))"mobile"===t.getAttribute("data-device")&&window.freedom.nsPubSub.pub("wishlist.checkFavoriteProducts");else{var e=window.freedom.getCookie("uuid");e&&!e.includes("anonymous")&&n()}window.freedom.nsPubSub.pub("wishlist.clickListener")}catch(i){console.error(i)}}()}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9fYmVoYXZpb3Ivd2lzaGxpc3QvYWxsL3dpc2hsaXN0Lm1pbi5qcyJdLCJuYW1lcyI6WyJTdHJpbmciLCJwcm90b3R5cGUiLCJpbmNsdWRlcyIsInNlYXJjaCIsInN0YXJ0IiwiUmVnRXhwIiwiVHlwZUVycm9yIiwidW5kZWZpbmVkIiwidGhpcyIsImluZGV4T2YiLCJJVEVNU19JTl9XSVNITElTVCIsImdldFJlc3VsdEFwaSIsInVybCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9wdGlvbnMiLCJtZXRob2QiLCJ0eXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwiZXJyb3IiLCJjb25zb2xlIiwid2luZG93IiwiZnJlZWRvbSIsInJlc3RDbGllbnQiLCJyZXF1ZXN0IiwicmVtb3ZlV2lzaGxpc3RJdGVtIiwiZWxlbWVudCIsImNvZGUiLCJwYXJlbnQiLCJwYXJlbnROb2RlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpdGVtIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwidGhlbiIsImFkZFdpc2hsaXN0SXRlbSIsInV1aWQiLCJnZXRDb29raWUiLCJjdXJyZW50VXJsIiwibG9jYXRpb24iLCJwYXRobmFtZSIsImdldEF0dHJpYnV0ZSIsImdldFdpc2hMaXN0SXRlbUJ5Q29kZSIsInJlc3VsdCIsImdldEFsbEl0ZW1zT25XaXNobGlzdCIsIkpTT04iLCJwYXJzZSIsImNoZWNrSXRlbXNJbkFycmF5IiwiaGVhcnQiLCJjb2RlSW5MaXN0IiwibWFwIiwiY2hlY2tGYXZvcml0ZVByb2R1Y3RzIiwiaGVhcnRzIiwiYWxsSXRlbXMiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJuc1B1YlN1YiIsInN1YiIsImNsaWNrRXZlbnQiLCJjb250YWlucyIsImNsaWNrTGlzdGVuZXIiLCJjb21wb25lbnRSZWluaXQiLCJIRUFSVCIsImxlbmd0aCIsIml0ZW1zIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJsaXZlIiwid2lzaGxpc3RIZWFydCIsInB1YiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFHS0EsUUFBT0MsVUFBVUMsV0FDcEJGLE9BQU9DLFVBQVVDLFNBQVcsU0FBU0MsRUFBUUMsR0FHM0MsR0FBSUQsWUFBa0JFLFFBQ3BCLEtBQU1DLFdBQVUsc0NBR2xCLE9BRGNDLFVBQVZILElBQXVCQSxFQUFRLEdBQzVCSSxLQUFLQyxRQUFRTixFQUFRQyxVQUsvQixXQUVDLEdBQUlNLEdBUUFDLEVBQWUsU0FBVUMsRUFBS0MsR0FDaEMsTUFBTyxJQUFJQyxTQUFRLFNBQVNDLEVBQVNDLEdBQ25DLEdBQUlDLElBQ0ZDLE9BQVEsTUFDUkMsS0FBTSxPQUNOTixLQUFNQSxFQUNOTyxRQUFTLFNBQVVDLEdBQ2pCTixFQUFRTSxJQUVWQyxNQUFPLFNBQVVBLEdBQ2ZDLFFBQVFELE1BQU0sbUJBQW9CQSxHQUNsQ04sR0FBTyxJQUdYUSxRQUFPQyxRQUFRQyxXQUFXQyxRQUFRZixFQUFLSyxNQVV2Q1csRUFBcUIsU0FBVUMsRUFBU0MsR0FDMUMsR0FBSUQsRUFBUyxDQUNYLEdBQUloQixNQUNBRCxFQUFNLG9CQUFzQmtCLEVBQzVCQyxFQUFTRixHQUFXQSxFQUFRRyxXQUFhSCxFQUFRRyxXQUFhLElBRTlEQyxVQUFTQyxjQUFjLG9CQUN6QkQsU0FBU0UsaUJBQWlCLGFBQWFDLFFBQVMsU0FBU0MsR0FDdkRBLEVBQUtDLFVBQVVDLE9BQU8sZ0JBQ3RCRixFQUFLSCxjQUFjLHNCQUFzQkksVUFBVUMsT0FBTyxpQ0FDMURGLEVBQUtILGNBQWMsc0JBQXNCSSxVQUFVRSxJQUFJLDZCQUdyRFQsR0FDRkYsRUFBUUcsV0FBV00sVUFBVUMsT0FBTyxnQkFFdENWLEVBQVFLLGNBQWMsS0FBS0ksVUFBVUMsT0FBTyxpQ0FDNUNWLEVBQVFLLGNBQWMsS0FBS0ksVUFBVUUsSUFBSSwyQkFFM0M3QixFQUFhQyxFQUFLQyxHQUFN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QUlRLEdBQWdCMUMsU0FBU0MsY0FBYyw2QkFFM0MsSUFBSXlDLEdBQWlFLFFBQWhEQSxFQUFjM0IsYUFBYSxpQkFDRyxXQUE5QzJCLEVBQWMzQixhQUFhLGdCQUM1QnhCLE9BQU9DLFFBQVFzQyxTQUFTYSxJQUFJLHNDQUV6QixDQUNMLEdBQUlqQyxHQUFPbkIsT0FBT0MsUUFBUW1CLFVBQVUsT0FDakNELEtBQVNBLEVBQUt6QyxTQUFTLGNBQ3hCaUQsSUFHSjNCLE9BQU9DLFFBQVFzQyxTQUFTYSxJQUFJLDBCQUM1QixNQUFPdEQsR0FDUEMsUUFBUUQsTUFBTUEiLCJmaWxlIjoiX3JlZmFjdG9yaW5nL19jb21wb25lbnRzL19iZWhhdmlvci93aXNobGlzdC9hbGwvd2lzaGxpc3QubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuaWYgKCFTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzKSB7XG4gIFN0cmluZy5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbihzZWFyY2gsIHN0YXJ0KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHNlYXJjaCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgdGhyb3cgVHlwZUVycm9yKCdmaXJzdCBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIFJlZ0V4cCcpO1xuICAgIH1cbiAgICBpZiAoc3RhcnQgPT09IHVuZGVmaW5lZCkgeyBzdGFydCA9IDA7IH1cbiAgICByZXR1cm4gdGhpcy5pbmRleE9mKHNlYXJjaCwgc3RhcnQpICE9PSAtMTtcbiAgfTtcbn1cbi8qIGVzbGludC1lbmFibGUgKi9cblxuKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgSVRFTVNfSU5fV0lTSExJU1Q7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0UmVzdWx0QXBpXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAgICogR2V0IHJlc3VsdHMgZnJvbSBhcGlcbiAgICovXG4gIHZhciBnZXRSZXN1bHRBcGkgPSBmdW5jdGlvbiAodXJsLCBkYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgIHR5cGU6ICdodG1sJyxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCd3aXNobGlzdCBlcnJvcjogJywgZXJyb3IpO1xuICAgICAgICAgIHJlamVjdChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QodXJsLCBvcHRpb25zKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCByZW1vdmVXaXNobGlzdEl0ZW1cbiAgICogQHBhcmFtIHtIVE1MRG9jdW1lbnR9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvZGVcbiAgICogUmVtb3ZlIGl0ZW0gb24gd2lzaCBsaXN0XG4gICAqL1xuICB2YXIgcmVtb3ZlV2lzaGxpc3RJdGVtID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNvZGUpIHtcbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgIHZhciB1cmwgPSAnL3dpc2hsaXN0L2RlbGV0ZS8nICsgY29kZTtcbiAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50ICYmIGVsZW1lbnQucGFyZW50Tm9kZSA/IGVsZW1lbnQucGFyZW50Tm9kZSA6IG51bGw7XG5cbiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmxvYXRpbmctYnV0dG9uJykpIHtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLndpc2hsaXN0JykuZm9yRWFjaCggZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnaGVhcnQtYWN0aXZlJyk7XG4gICAgICAgICAgaXRlbS5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QucmVtb3ZlKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0LWFjdGl2ZScpO1xuICAgICAgICAgIGl0ZW0ucXVlcnlTZWxlY3RvcignLndpc2hsaXN0X19oZWFydCBpJykuY2xhc3NMaXN0LmFkZCgnbnMtaWNvbi13aXNobGlzdC1oZWFydCcpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnaGVhcnQtYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NMaXN0LnJlbW92ZSgnbnMtaWNvbi13aXNobGlzdC1oZWFydC1hY3RpdmUnKTtcbiAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NMaXN0LmFkZCgnbnMtaWNvbi13aXNobGlzdC1oZWFydCcpO1xuICAgICAgfVxuICAgICAgZ2V0UmVzdWx0QXBpKHVybCwgZGF0YSkudGhlbigpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhZGRXaXNobGlzdEl0ZW1cbiAgICogQHBhcmFtIHtIVE1MRG9jdW1lbnR9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvZGVcbiAgICogQWRkIGl0ZW0gdG8gd2lzaGxpc3RcbiAgICovXG4gIHZhciBhZGRXaXNobGlzdEl0ZW0gPSBmdW5jdGlvbiAoZWxlbWVudCwgY29kZSkge1xuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgdmFyIHVybCA9ICcvd2lzaGxpc3QvYWRkLycgKyBjb2RlO1xuICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQgJiYgZWxlbWVudC5wYXJlbnROb2RlID8gZWxlbWVudC5wYXJlbnROb2RlIDogbnVsbDtcblxuICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mbG9hdGluZy1idXR0b24nKSkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcud2lzaGxpc3QnKS5mb3JFYWNoKCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgaXRlbS5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QucmVtb3ZlKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0Jyk7XG4gICAgICAgICAgaXRlbS5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QuYWRkKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0LWFjdGl2ZScpO1xuICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnaGVhcnQtYWN0aXZlJyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgIHBhcmVudC5jbGFzc0xpc3QuYWRkKCdoZWFydC1hY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc0xpc3QucmVtb3ZlKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0Jyk7XG4gICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTGlzdC5hZGQoJ25zLWljb24td2lzaGxpc3QtaGVhcnQtYWN0aXZlJyk7XG4gICAgICB9XG4gICAgICBnZXRSZXN1bHRBcGkodXJsLCBkYXRhKS50aGVuKCk7XG5cbiAgICAgIHZhciB1dWlkID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCd1dWlkJyk7XG4gICAgICBpZih1dWlkICYmIHV1aWQuaW5jbHVkZXMoJ2Fub255bW91cycpKSB7XG4gICAgICAgIHZhciBjdXJyZW50VXJsID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICsgJz8nICsgZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaHJlZicpO1xuICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAnL2xvZ2luP3JlZGlyZWN0PScgKyBjdXJyZW50VXJsO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRXaXNoTGlzdEl0ZW1CeUNvZGVcbiAgICogQHBhcmFtIHtIVE1MRG9jdW1lbnR9IGVsZW1lbnRcbiAgICogR2V0IHdpc2hsaXN0IGl0ZW0gYnkgY29kZVxuICAgKi9cbiAgdmFyIGdldFdpc2hMaXN0SXRlbUJ5Q29kZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICB2YXIgY29kZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvZGUnKTtcbiAgICB2YXIgZGF0YSA9IHt9O1xuICAgIHZhciB1cmwgPSAnL3dpc2hsaXN0LycgKyBjb2RlO1xuICAgIGdldFJlc3VsdEFwaSh1cmwsIGRhdGEpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICBpZihyZXN1bHQgIT09ICdmYWxzZScpIHtcbiAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QucmVtb3ZlKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0Jyk7XG4gICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLndpc2hsaXN0X19oZWFydCBpJykuY2xhc3NMaXN0LmFkZCgnbnMtaWNvbi13aXNobGlzdC1oZWFydC1hY3RpdmUnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRBbGxJdGVtc09uV2lzaGxpc3RcbiAgICogR2V0IGFsbCBpdGVtcyBpbiB0aGUgd2lzaCBsaXN0IGFuZCBhZGQgaW4gYSB2YXJpYWJsZVxuICAgKi9cbiAgdmFyIGdldEFsbEl0ZW1zT25XaXNobGlzdCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkYXRhID0ge307XG4gICAgdmFyIHVybCA9ICcvd2lzaGxpc3QvYWxsJztcbiAgICBnZXRSZXN1bHRBcGkodXJsLCBkYXRhKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgSVRFTVNfSU5fV0lTSExJU1QgPSBKU09OLnBhcnNlKHJlc3VsdCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2hlY2tJdGVtc0luQXJyYXlcbiAgICogQHBhcmFtIHtIVE1MRG9jdW1lbnR9IGhlYXJ0XG4gICAqIENoZWNrIGlmIHlvdSBoYXZlIHRoZSBjb2RlIGluIHRoZSBhcnJheVxuICAgKi9cbiAgdmFyIGNoZWNrSXRlbXNJbkFycmF5ID0gZnVuY3Rpb24oaGVhcnQpIHtcbiAgICB2YXIgY29kZSA9IGhlYXJ0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2RlJyk7XG4gICAgdmFyIGNvZGVJbkxpc3QgPSBJVEVNU19JTl9XSVNITElTVC5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgcmV0dXJuIGl0ZW0uY29kZTtcbiAgICB9KS5pbmRleE9mKGNvZGUpO1xuICAgIGlmKGNvZGVJbkxpc3QgIT09IC0xKSB7XG4gICAgICBoZWFydC5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QucmVtb3ZlKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0Jyk7XG4gICAgICBoZWFydC5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QuYWRkKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0LWFjdGl2ZScpO1xuICAgIH1cbiAgfTtcblxuICAvL0V2ZW50c1xuICAvKipcbiAgICogQG1ldGhvZCAgY2hlY2tGYXZvcml0ZVByb2R1Y3RzXG4gICAqIENoZWNrcyBpZiB0aGUgcHJvZHVjdHMgaXMgc2VsZWN0ZWQgaW4gdGhlIHdpc2hsaXN0XG4gICAqL1xuICB2YXIgY2hlY2tGYXZvcml0ZVByb2R1Y3RzID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIHZhciBoZWFydHMgPSBlbGVtZW50ID8gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0JykgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcud2lzaGxpc3RfX2hlYXJ0Jyk7XG4gICAgaWYoZWxlbWVudCkge1xuICAgICAgdmFyIGFsbEl0ZW1zID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKElURU1TX0lOX1dJU0hMSVNUKSB7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChhbGxJdGVtcyk7XG4gICAgICAgICAgY2hlY2tJdGVtc0luQXJyYXkoaGVhcnRzKTtcbiAgICAgICAgfVxuICAgICAgfSwgMTAwMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhlYXJ0cy5mb3JFYWNoKGZ1bmN0aW9uKGhlYXJ0KSB7XG4gICAgICAgIGdldFdpc2hMaXN0SXRlbUJ5Q29kZShoZWFydCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfTtcbiAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCd3aXNobGlzdC5jaGVja0Zhdm9yaXRlUHJvZHVjdHMnLCBjaGVja0Zhdm9yaXRlUHJvZHVjdHMpO1xuXG4gIHZhciBjbGlja0V2ZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNvZGUgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1jb2RlJyk7XG4gICAgaWYgKHRoaXMucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTGlzdC5jb250YWlucygnbnMtaWNvbi13aXNobGlzdC1oZWFydC1hY3RpdmUnKSkge1xuICAgICAgLy9SZW1vdmUgZnJvbSB3aXNoIGxpc3RcbiAgICAgIHJlbW92ZVdpc2hsaXN0SXRlbSh0aGlzLCBjb2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9BZGQgdG8gd2lzaCBsaXN0XG4gICAgICBhZGRXaXNobGlzdEl0ZW0odGhpcywgY29kZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNsaWNrTGlzdGVuZXJcbiAgICogQHBhcmFtIHtET01lbGVtZW50fSBIRUFSVFxuICAgKiBMaXN0ZW4gdG8gY2xpY2sgZXZlbnRzIGluIHRoZSBoZWFydFxuICAgKi9cbiAgdmFyIGNsaWNrTGlzdGVuZXIgPSBmdW5jdGlvbiAoY29tcG9uZW50UmVpbml0KSB7XG5cbiAgICB2YXIgSEVBUlQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcud2lzaGxpc3RfX2hlYXJ0Jyk7XG4gICAgaWYoSEVBUlQubGVuZ3RoID4gMSkge1xuICAgICAgSEVBUlQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgaWYoY29tcG9uZW50UmVpbml0KSB7XG4gICAgICAgICAgaXRlbXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGlja0V2ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBpdGVtcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsaWNrRXZlbnQpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJy53aXNobGlzdF9faGVhcnQnLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNvZGUgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1jb2RlJyk7XG4gICAgICAgIGlmICh0aGlzLnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc0xpc3QuY29udGFpbnMoJ25zLWljb24td2lzaGxpc3QtaGVhcnQtYWN0aXZlJykpIHtcbiAgICAgICAgICAvL1JlbW92ZSBmcm9tIHdpc2ggbGlzdFxuICAgICAgICAgIHJlbW92ZVdpc2hsaXN0SXRlbSh0aGlzLCBjb2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvL0FkZCB0byB3aXNoIGxpc3RcbiAgICAgICAgICBhZGRXaXNobGlzdEl0ZW0odGhpcywgY29kZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbiAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCd3aXNobGlzdC5jbGlja0xpc3RlbmVyJywgY2xpY2tMaXN0ZW5lcik7XG5cbiAgKGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHdpc2hsaXN0SGVhcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3QgLndpc2hsaXN0X19oZWFydCcpO1xuXG4gICAgICBpZigod2lzaGxpc3RIZWFydCAmJiB3aXNobGlzdEhlYXJ0LmdldEF0dHJpYnV0ZSgnZGF0YS10ZW1wbGF0ZScpID09PSAncGRwJykpIHtcbiAgICAgICAgaWYod2lzaGxpc3RIZWFydC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGV2aWNlJykgPT09ICdtb2JpbGUnKSB7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCd3aXNobGlzdC5jaGVja0Zhdm9yaXRlUHJvZHVjdHMnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHV1aWQgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3V1aWQnKTtcbiAgICAgICAgaWYodXVpZCAmJiAhdXVpZC5pbmNsdWRlcygnYW5vbnltb3VzJykpIHtcbiAgICAgICAgICBnZXRBbGxJdGVtc09uV2lzaGxpc3QoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCd3aXNobGlzdC5jbGlja0xpc3RlbmVyJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgfSgpKTtcbn0oKSk7XG4iXX0=
