"use strict";!function(){function e(){l=window.freedom.getCookie("zipcode")}var o=document.querySelector.bind(document),i=window.freedom.nsPubSub,r="data-link-rules",n=".rules-page",t={container:".freeDelivery-container",modal:".freeDelivery-modal",modal_content:".modal-content",gif:".freeDelivery-gif",close:".modal-close"},l=window.freedom.getCookie("zipcode"),d=window.freedom.getCookie("fshipEligible"),c=document.querySelector("section[data-free-shipping-by-zipcode]"),s=document.querySelector("section[data-get-zipcode-info]"),a=function(){s?window.zipcodeAPIsAjax?window.freedom.nsPubSub.pub("nsLoading.hide",document.body):window.zipcodeAPIsAjax=!0:window.freedom.nsPubSub.pub("nsLoading.hide",document.body)},u={init:function(){this.events.openModalRules()},helpers:{checkLink:function(){var e=o(t.container).getAttribute(r);null!==e&&""!==e&&u.events.getAjax(e)},hideAll:function(){var e=document.querySelectorAll(".rules-content > article");e.forEach(function(e){e.classList.add("hide")})},showFreeDelivery:function(){document.querySelector('#comboreg [value="frete-gratis"]').selected=!0,document.querySelector("#frete-gratis").classList.remove("hide")}},events:{getAjax:function(e){var o=e,i={displayLoading:!1,method:"get",success:function(e){var o=document.createElement("div");o.innerHTML=e;var i=o,r=i.querySelector(n);u.handlers.render(r)},error:function(){console.log("ERROR | FreeDelivery")}};window.freedom.restClient.request(o,i)},openModalRules:function(){window.freedom.live(t.gif,"click",function(){null!==o(n)?(o(t.modal).classList.remove("hide"),i.pub("overlay.display","show"),document.getElementById("frete-gratis").scrollIntoView(!0)):u.helpers.checkLink()})},closeModalRules:function(){window.freedom.live(t.close,"click",function(){o(t.modal).classList.add("hide"),i.pub("overlay.display","hide")}),window.freedom.live("#overlay","click",function(){o(t.modal).classList.add("hide")})},scrolling:function(){var e,i=o(t.modal).offsetHeight,r=o(n).offsetHeight;o(t.modal).onscroll=function(){i=o(t.modal).offsetHeight,r=o(n).offsetHeight,e=o(t.modal).scrollTop,e+i>r?o(".freeDelivery-modal .modal-top").classList.remove("scroll"):o(".freeDelivery-modal .modal-top").classList.add("scroll")}},changeSelected:function(){window.freedom.live("#comboreg","change",function(e){var i=e.target.value;u.helpers.hideAll(),document.getElementById(i).classList.remove("hide"),o(t.modal).scrollTop=0})}},handlers:{render:function(e){if(null!==e){var r=o(t.modal_content);r&&r.appendChild(e),u.events.closeModalRules(),u.events.scrolling(),window.freedom.isMobile?(o(t.container).classList.add("mb"),u.helpers.hideAll(),u.events.changeSelected(),u.helpers.showFreeDelivery(),o(t.modal).classList.remove("hide")):(i.pub("overlay.display","show"),o(t.modal).classList.remove("hide"),document.getElementById("frete-gratis").scrollIntoView(!0))}}}},f=function(){d=window.freedom.getCookie("fshipEligible")},m=function(e,o,i){var r,n,t,c,s;if(e){var u=document.createElement("div");u.innerHTML=e,n=u.firstElementChild,r=n.querySelector('.buy-button-now.button-no-float[data-sku*="-"]'),t=o}else r=document.querySelector('.buy-button-now.button-no-float[data-sku*="-"]'),n=document.querySelector("#buy-box");r&&(c=r.getAttribute("data-sku"),s=r.getAttribute("data-seller")),"true"===d&&r?window.freedom.nsPubSub.pub("verifyFreeShipping",c,s,l,n,t,i):"false"===d?(n.querySelector(".freeDelivery-container")&&n.querySelector(".freeDelivery-container").classList.add("hide"),e&&window.freedom.nsPubSub.pub("returnCheckedFreeShipping",t,n,i),a()):(d||"string"!=typeof d)&&r||(n.querySelector(".freeDelivery-container")&&n.querySelector(".freeDelivery-container").classList.remove("hide"),n.querySelector(".freeDelivery-gif")&&n.querySelector(".freeDelivery-gif").classList.remove("hide"),n.querySelector(".freeDelivery-container .ns-icon-free-shipping")&&(n.querySelector(".freeDelivery-container .ns-icon-free-shipping").classList.add("hide"),n.querySelector(".freeDelivery-container .tag-shipping.new-tag").classList.add("hide")),window.freedom.nsPubSub.pub("nsLoading.hide",document.body),e&&window.freedom.nsPubSub.pub("returnCheckedFreeShipping",t,n,i))};try{u.init(),c&&"product"===dataLayer[0].page.pageID.toLowerCase()?"true"===d?m():"false"===d?document.querySelector(".freeDelivery-container")&&document.querySelector(".freeDelivery-container").classList.add("hide"):d||"string"!=typeof d||(document.querySelector(".freeDelivery-container")&&document.querySelector(".freeDelivery-container").classList.remove("hide"),document.querySelector(".freeDelivery-container .ns-icon-free-shipping")&&(document.querySelector(".freeDelivery-container .ns-icon-free-shipping").classList.add("hide"),document.querySelector(".freeDelivery-container .tag-shipping.new-tag").classList.add("hide"))):c||"product"!==dataLayer[0].page.pageID.toLowerCase()||document.querySelector(".freeDelivery-container")&&document.querySelector(".freeDelivery-container").classList.remove("hide"),window.freedom.nsPubSub.sub("change.ColorFlavorSize.freeShipping",m),window.freedom.nsPubSub.sub("returnShippingEligibility.PDP",m),window.freedom.nsPubSub.sub("zipcodeCookie.reinit",e),window.freedom.nsPubSub.sub("shippingEligibleCookie.reinit",f)}catch(y){console.error("ERROR | FreeDelivery PDP"+y)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9mcmVlLWRlbGl2ZXJ5LTIvYWxsL2ZyZWUtZGVsaXZlcnkubWluLmpzIl0sIm5hbWVzIjpbInJlaW5pdFppcGNvZGVDb29raWUiLCJjb29raWVaaXBjb2RlIiwid2luZG93IiwiZnJlZWRvbSIsImdldENvb2tpZSIsIiRxcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJpbmQiLCJQVUJTVUIiLCJuc1B1YlN1YiIsIkxJTktfUlVMRVMiLCJDT05URU5UX1JVTEVTIiwiRlJFRV9ERUxJVkVSWSIsImNvbnRhaW5lciIsIm1vZGFsIiwibW9kYWxfY29udGVudCIsImdpZiIsImNsb3NlIiwiY29va2llU2hpcHBpbmdFbGlnaWJsZSIsImNoZWNrRnJlZVNoaXBwaW5nRW5hYmxlZCIsImdldFppcGNvZGVJbmZvRW5hYmxlZCIsInVwZGF0ZUxvYWRpbmdTdGF0ZSIsInppcGNvZGVBUElzQWpheCIsInB1YiIsImJvZHkiLCJGcmVlRGVsaXZlcnkiLCJpbml0IiwidGhpcyIsImV2ZW50cyIsIm9wZW5Nb2RhbFJ1bGVzIiwiaGVscGVycyIsImNoZWNrTGluayIsImxpbmsiLCJnZXRBdHRyaWJ1dGUiLCJnZXRBamF4IiwiaGlkZUFsbCIsImFsbERpdkNvbnRlbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJjbGFzc0xpc3QiLCJhZGQiLCJzaG93RnJlZURlbGl2ZXJ5Iiwic2VsZWN0ZWQiLCJyZW1vdmUiLCJ1cmwiLCJ1cmxSdWxlIiwib3B0aW9ucyIsImRpc3BsYXlMb2FkaW5nIiwibWV0aG9kIiwic3VjY2VzcyIsImRhdGEiLCJodG1sT2JqZWN0IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImRvYyIsInJlc3VsdCIsImhhbmRsZXJzIiwicmVuZGVyIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwicmVzdENsaWVudCIsInJlcXVlc3QiLCJsaXZlIiwiZ2V0RWxlbWVudEJ5SWQiLCJzY3JvbGxJbnRvVmlldyIsImNsb3NlTW9kYWxSdWxlcyIsInNjcm9sbGluZyIsInRvdGFsU2Nyb2xsIiwibW9kYWxIZWlnaHQiLCJvZmZzZXRIZWlnaHQiLCJlbGVtZW50SGVpZ2h0Iiwib25zY3JvbGwiLCJzY3JvbGxUb3AiLCJjaGFuZ2VTZWxlY3RlZCIsImUiLCJpdGVtU2VsZWN0ZWQiLCJ0YXJnZXQiLCJ2YWx1ZSIsInJlc3BvbnNlIiwiJG1vZGFsQ29udGVudCIsImFwcGVuZENoaWxkIiwiaXNNb2JpbGUiLCJyZWluaXRDb29raWVTaGlwcGluZ0VsaWdpYmxlIiwidmVyaWZ5U2hpcHBpbmdCeVppcGNvZGUiLCJjb250ZW50IiwicHJvcGVydGllcyIsImVsZW1lbnQiLCJidXlCdG4iLCJwcm9wIiwic2t1Iiwic2VsbGVySWQiLCJ0ZW1wIiwiZmlyc3RFbGVtZW50Q2hpbGQiLCJkYXRhTGF5ZXIiLCJwYWdlIiwicGFnZUlEIiwidG9Mb3dlckNhc2UiLCJzdWIiLCJlcnIiXSwibWFwcGluZ3MiOiJBQUFBLGNBQ0MsV0F3TUMsUUFBU0EsS0FDUEMsRUFBZ0JDLE9BQU9DLFFBQVFDLFVBQVUsV0F4TTNDLEdBQUlDLEdBQU1DLFNBQVNDLGNBQWNDLEtBQUtGLFVBQ3BDRyxFQUFTUCxPQUFPQyxRQUFRTyxTQUN4QkMsRUFBYSxrQkFDYkMsRUFBZ0IsY0FDaEJDLEdBQ0VDLFVBQVcsMEJBQ1hDLE1BQU8sc0JBQ1BDLGNBQWUsaUJBQ2ZDLElBQUssb0JBQ0xDLE1BQU8sZ0JBRVRqQixFQUFnQkMsT0FBT0MsUUFBUUMsVUFBVSxXQUN6Q2UsRUFBeUJqQixPQUFPQyxRQUFRQyxVQUFVLGlCQUNsRGdCLEVBQTJCZCxTQUFTQyxjQUFjLDBDQUloRGMsRUFBd0JmLFNBQVNDLGNBQWMsa0NBTy9DZSxFQUFxQixXQUNuQkQsRUFDRW5CLE9BQU9xQixnQkFDVHJCLE9BQU9DLFFBQVFPLFNBQVNjLElBQUksaUJBQWtCbEIsU0FBU21CLE1BRXZEdkIsT0FBT3FCLGlCQUFrQixFQUczQnJCLE9BQU9DLFFBQVFPLFNBQVNj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LGNBQWMsaURBQWlEa0MsVUFBVUMsSUFBSSxTQUd6RnhDLE9BQU9DLFFBQVFPLFNBQVNjLElBQUksaUJBQWtCbEIsU0FBU21CLE1BRW5EOEQsR0FBU3JGLE9BQU9DLFFBQVFPLFNBQVNjLElBQUksNEJBQTZCbUUsRUFBTTdFLEVBQVcyRSxJQUszRixLQUNFL0QsRUFBYUMsT0FHVFAsR0FBdUUsWUFBM0M0RSxVQUFVLEdBQUdDLEtBQUtDLE9BQU9DLGNBQ3hCLFNBQTNCaEYsRUFDRm1FLElBQ29DLFVBQTNCbkUsRUFDTGIsU0FBU0MsY0FBYyw0QkFBNEJELFNBQVNDLGNBQWMsMkJBQTJCa0MsVUFBVUMsSUFBSSxRQUM3R3ZCLEdBQTRELGdCQUEzQkEsS0FDdkNiLFNBQVNDLGNBQWMsNEJBQTRCRCxTQUFTQyxjQUFjLDJCQUEyQmtDLFVBQVVJLE9BQU8sUUFDdEh2QyxTQUFTQyxjQUFjLG9EQUN6QkQsU0FBU0MsY0FBYyxrREFBa0RrQyxVQUFVQyxJQUFJLFFBQ3ZGcEMsU0FBU0MsY0FBYyxpREFBaURrQyxVQUFVQyxJQUFJLFVBR2hGdEIsR0FBdUUsWUFBM0M0RSxVQUFVLEdBQUdDLEtBQUtDLE9BQU9DLGVBQzNEN0YsU0FBU0MsY0FBYyw0QkFBNEJELFNBQVNDLGNBQWMsMkJBQTJCa0MsVUFBVUksT0FBTyxRQUU1SDNDLE9BQU9DLFFBQVFPLFNBQVMwRixJQUFJLHNDQUF1Q2QsR0FDbkVwRixPQUFPQyxRQUFRTyxTQUFTMEYsSUFBSSxnQ0FBaUNkLEdBQzdEcEYsT0FBT0MsUUFBUU8sU0FBUzBGLElBQUksdUJBQXdCcEcsR0FDcERFLE9BQU9DLFFBQVFPLFNBQVMwRixJQUFJLGdDQUFpQ2YsR0FFN0QsTUFBT2dCLEdBQ1B4QyxRQUFRRCxNQUFNLDJCQUE2QnlDIiwiZmlsZSI6Il9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9mcmVlLWRlbGl2ZXJ5LTIvYWxsL2ZyZWUtZGVsaXZlcnkubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICRxcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IuYmluZChkb2N1bWVudCksXG4gICAgUFVCU1VCID0gd2luZG93LmZyZWVkb20ubnNQdWJTdWIsXG4gICAgTElOS19SVUxFUyA9ICdkYXRhLWxpbmstcnVsZXMnLFxuICAgIENPTlRFTlRfUlVMRVMgPSAnLnJ1bGVzLXBhZ2UnLFxuICAgIEZSRUVfREVMSVZFUlkgPSB7XG4gICAgICBjb250YWluZXI6ICcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicsXG4gICAgICBtb2RhbDogJy5mcmVlRGVsaXZlcnktbW9kYWwnLFxuICAgICAgbW9kYWxfY29udGVudDogJy5tb2RhbC1jb250ZW50JyxcbiAgICAgIGdpZjogJy5mcmVlRGVsaXZlcnktZ2lmJyxcbiAgICAgIGNsb3NlOiAnLm1vZGFsLWNsb3NlJ1xuICAgIH0sXG4gICAgY29va2llWmlwY29kZSA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnemlwY29kZScpLFxuICAgIGNvb2tpZVNoaXBwaW5nRWxpZ2libGUgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ2ZzaGlwRWxpZ2libGUnKSxcbiAgICBjaGVja0ZyZWVTaGlwcGluZ0VuYWJsZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzZWN0aW9uW2RhdGEtZnJlZS1zaGlwcGluZy1ieS16aXBjb2RlXScpO1xuXG4gIC8vIHRoaXMgdmFyIGNoZWNrIGlmIFtnZXQtemlwY29kZS1pbmZvXSBvciBbZnJlZS1zaGlwcGluZ10gaXMgZW5hYmxlZCwgYmVjYXVzZSB0aGUgW2luc2VydC16aXAtY29kZV0gaW50ZXJhY3Qgd2l0aCBib3RoIEFQSXNcbiAgLy8gaXQgd2FzIG5lZWQgdHdvIHN5bmMgdGhlIG5zTG9hZGluZyBzdGF0ZSBvbiB0aGUgY2FsbGJhY2sgZnVuYyBvZiBib3RoIGZlYXR1cmVzIFxuICB2YXIgZ2V0WmlwY29kZUluZm9FbmFibGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2VjdGlvbltkYXRhLWdldC16aXBjb2RlLWluZm9dJyk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdXBkYXRlTG9hZGluZ1N0YXRlXG4gICAqIEZ1bmN0aW9uIHRvIHN5bmMgdGhlIG5zTG9hZGluZyBzdGF0ZSBvbiB0aGUgY2FsbGJhY2sgZnVuYyBvZiB3aGVuIGNoYW5nZSB0aGUgemlwY29kZSBvbiBbaW5zZXJ0LXppcC1jb2RlXVxuICAgKiBbZnJlZS1zaGlwcGluZ10gYW5kIFtnZXQtemlwY29kZS1pbmZvXSByZXNwb25kcyBvbiB6aXBjb2RlIGNvb2tpZSBjaGFuZ2VzXG4gICAqL1xuICB2YXIgdXBkYXRlTG9hZGluZ1N0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChnZXRaaXBjb2RlSW5mb0VuYWJsZWQpIHtcbiAgICAgIGlmICh3aW5kb3cuemlwY29kZUFQSXNBamF4KSB7XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbnNMb2FkaW5nLmhpZGUnLCBkb2N1bWVudC5ib2R5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy56aXBjb2RlQVBJc0FqYXggPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ25zTG9hZGluZy5oaWRlJywgZG9jdW1lbnQuYm9keSk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBGcmVlRGVsaXZlcnkgPSB7XG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5ldmVudHMub3Blbk1vZGFsUnVsZXMoKTtcbiAgICB9LFxuICAgIGhlbHBlcnM6IHtcbiAgICAgIC8qKlxuICAgICAgICogW2NoZWNrTGlua11cbiAgICAgICAqIGNoZWNrIGlmIGV4aXN0IGxpbmsgdG8gcnVsZXNcbiAgICAgICAqKi9cbiAgICAgIGNoZWNrTGluazogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGluayA9ICRxcyhGUkVFX0RFTElWRVJZLmNvbnRhaW5lcikuZ2V0QXR0cmlidXRlKExJTktfUlVMRVMpO1xuICAgICAgICBpZiAobGluayAhPT0gbnVsbCAmJiBsaW5rICE9PSBcIlwiKSB7XG4gICAgICAgICAgRnJlZURlbGl2ZXJ5LmV2ZW50cy5nZXRBamF4KGxpbmspO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaGlkZUFsbDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYWxsRGl2Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ydWxlcy1jb250ZW50ID4gYXJ0aWNsZScpO1xuICAgICAgICBhbGxEaXZDb250ZW50LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgc2hvd0ZyZWVEZWxpdmVyeTogZnVuY3Rpb24gKCkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29tYm9yZWcgW3ZhbHVlPVwiZnJldGUtZ3JhdGlzXCJdJykuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZnJldGUtZ3JhdGlzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXZlbnRzOiB7XG4gICAgICAvKipcbiAgICAgICAqIFtnZXRBamF4XVxuICAgICAgICogYWpheCB0byBnZXQgY29udGVudCBmcm9tIHJlZ3VsYXRpb25zXG4gICAgICAgKiovXG4gICAgICBnZXRBamF4OiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIHZhciB1cmxSdWxlID0gdXJsO1xuXG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgIGRpc3BsYXlMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICBtZXRob2Q6ICdnZXQnLFxuXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBodG1sT2JqZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBodG1sT2JqZWN0LmlubmVySFRNTCA9IGRhdGE7XG4gICAgICAgICAgICB2YXIgZG9jID0gaHRtbE9iamVjdDtcblxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGRvYy5xdWVyeVNlbGVjdG9yKENPTlRFTlRfUlVMRVMpO1xuICAgICAgICAgICAgRnJlZURlbGl2ZXJ5LmhhbmRsZXJzLnJlbmRlcihyZXN1bHQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiB8IEZyZWVEZWxpdmVyeScpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLnJlc3RDbGllbnQucmVxdWVzdCh1cmxSdWxlLCBvcHRpb25zKTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIFtvcGVuTW9kYWxSdWxlc11cbiAgICAgICAqIG9wZW4gbW9kYWxcbiAgICAgICAqKi9cbiAgICAgIG9wZW5Nb2RhbFJ1bGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoRlJFRV9ERUxJVkVSWS5naWYsICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAvL0FMVEVSQVIgU0VMRVRPUlxuICAgICAgICAgIGlmICgkcXMoQ09OVEVOVF9SVUxFUykgIT09IG51bGwpIHtcbiAgICAgICAgICAgICRxcyhGUkVFX0RFTElWRVJZLm1vZGFsKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICBQVUJTVUIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnc2hvdycpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmcmV0ZS1ncmF0aXNcIikuc2Nyb2xsSW50b1ZpZXcodHJ1ZSk7XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgRnJlZURlbGl2ZXJ5LmhlbHBlcnMuY2hlY2tMaW5rKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIFtjbG9zZU1vZGFsUnVsZXNdXG4gICAgICAgKiBjbG9zZSBtb2RhbFxuICAgICAgICoqL1xuICAgICAgY2xvc2VNb2RhbFJ1bGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGJ0IGNsb3NlXG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoRlJFRV9ERUxJVkVSWS5jbG9zZSwgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRxcyhGUkVFX0RFTElWRVJZLm1vZGFsKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgICAgUFVCU1VCLnB1Yignb3ZlcmxheS5kaXNwbGF5JywgJ2hpZGUnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIG92ZXJsYXlcbiAgICAgICAgd2luZG93LmZyZWVkb20ubGl2ZSgnI292ZXJsYXknLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJHFzKEZSRUVfREVMSVZFUlkubW9kYWwpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBbc2Nyb2xsaW5nXVxuICAgICAgICogY2hlY2sgaWYgc2Nyb2xsIGhhcyByZWFjaGVkIHRoZSBib3R0b21cbiAgICAgICAqKi9cbiAgICAgIHNjcm9sbGluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbW9kYWxIZWlnaHQgPSAkcXMoRlJFRV9ERUxJVkVSWS5tb2RhbCkub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB2YXIgZWxlbWVudEhlaWdodCA9ICRxcyhDT05URU5UX1JVTEVTKS5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIHZhciB0b3RhbFNjcm9sbDtcblxuICAgICAgICAkcXMoRlJFRV9ERUxJVkVSWS5tb2RhbCkub25zY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbW9kYWxIZWlnaHQgPSAkcXMoRlJFRV9ERUxJVkVSWS5tb2RhbCkub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgIGVsZW1lbnRIZWlnaHQgPSAkcXMoQ09OVEVOVF9SVUxFUykub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgIHRvdGFsU2Nyb2xsID0gJHFzKEZSRUVfREVMSVZFUlkubW9kYWwpLnNjcm9sbFRvcDtcblxuICAgICAgICAgIGlmICh0b3RhbFNjcm9sbCArIG1vZGFsSGVpZ2h0ID4gZWxlbWVudEhlaWdodCkge1xuICAgICAgICAgICAgJHFzKCcuZnJlZURlbGl2ZXJ5LW1vZGFsIC5tb2RhbC10b3AnKS5jbGFzc0xpc3QucmVtb3ZlKCdzY3JvbGwnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHFzKCcuZnJlZURlbGl2ZXJ5LW1vZGFsIC5tb2RhbC10b3AnKS5jbGFzc0xpc3QuYWRkKCdzY3JvbGwnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBbZm9yIG1vYmlsZV1bY2hhbmdlU2VsZWN0ZWRdXG4gICAgICAgKiBldmVudCB0byBjaGFuZ2UgaXRlbSBzZWxlY3RlZFxuICAgICAgICoqL1xuICAgICAgY2hhbmdlU2VsZWN0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubGl2ZSgnI2NvbWJvcmVnJywgJ2NoYW5nZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIGl0ZW1TZWxlY3RlZCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgIEZyZWVEZWxpdmVyeS5oZWxwZXJzLmhpZGVBbGwoKTtcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtU2VsZWN0ZWQpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgICAkcXMoRlJFRV9ERUxJVkVSWS5tb2RhbCkuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBoYW5kbGVyczoge1xuICAgICAgLyoqXG4gICAgICAgKiBbcmVuZGVyXVxuICAgICAgICogYXBwZW5kIGNvbnRlbnQgb2YgcnVsZXNcbiAgICAgICAqKi9cbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSAhPT0gbnVsbCkge1xuICAgICAgICAgIC8vIGFwcGVuZCBjb250ZW50IHRvIG1vZGFsXG4gICAgICAgICAgdmFyICRtb2RhbENvbnRlbnQgPSAkcXMoRlJFRV9ERUxJVkVSWS5tb2RhbF9jb250ZW50KTtcbiAgICAgICAgICBpZiAoJG1vZGFsQ29udGVudCkge1xuICAgICAgICAgICAgJG1vZGFsQ29udGVudC5hcHBlbmRDaGlsZChyZXNwb25zZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgRnJlZURlbGl2ZXJ5LmV2ZW50cy5jbG9zZU1vZGFsUnVsZXMoKTtcbiAgICAgICAgICBGcmVlRGVsaXZlcnkuZXZlbnRzLnNjcm9sbGluZygpO1xuXG4gICAgICAgICAgLy8gTW9iaWxlXG4gICAgICAgICAgaWYgKHdpbmRvdy5mcmVlZG9tLmlzTW9iaWxlKSB7XG4gICAgICAgICAgICAkcXMoRlJFRV9ERUxJVkVSWS5jb250YWluZXIpLmNsYXNzTGlzdC5hZGQoJ21iJyk7XG5cbiAgICAgICAgICAgIEZyZWVEZWxpdmVyeS5oZWxwZXJzLmhpZGVBbGwoKTtcbiAgICAgICAgICAgIEZyZWVEZWxpdmVyeS5ldmVudHMuY2hhbmdlU2VsZWN0ZWQoKTtcbiAgICAgICAgICAgIEZyZWVEZWxpdmVyeS5oZWxwZXJzLnNob3dGcmVlRGVsaXZlcnkoKTtcblxuICAgICAgICAgICAgLy8gc2hvdyBtb2RhbFxuICAgICAgICAgICAgJHFzKEZSRUVfREVMSVZFUlkubW9kYWwpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gRGVza3RvcFxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgUFVCU1VCLnB1Yignb3ZlcmxheS5kaXNwbGF5JywgJ3Nob3cnKTtcbiAgICAgICAgICAgIC8vIHNob3cgbW9kYWxcbiAgICAgICAgICAgICRxcyhGUkVFX0RFTElWRVJZLm1vZGFsKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICAvLyBzY3JvbGwgdG8gZnJldGVcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZnJldGUtZ3JhdGlzXCIpLnNjcm9sbEludG9WaWV3KHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCByZWluaXRaaXBjb2RlQ29va2llIGNoYW5nZUNvbG9yIGNoYW5nZUZsYXZvclxuICAgKiBFYWNoIGZ1bmN0aW9ucyB3YXRjaCByZXNwZWN0aXZlIGNoYW5nZXMgb2YgY29sb3IsIGZsYXZvciBhbmQgc2l6ZVxuICAgKiBAcGFyYW0gIHt9XG4gICAqL1xuICBmdW5jdGlvbiByZWluaXRaaXBjb2RlQ29va2llKCkge1xuICAgIGNvb2tpZVppcGNvZGUgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3ppcGNvZGUnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHJlaW5pdENvb2tpZVNoaXBwaW5nRWxpZ2libGVcbiAgICogR2V0IGNvb2tpZSBieSBuYW1lXG4gICAqIEByZXR1cm4ge3N0cmluZ30gW3ppcGNvZGVdXG4gICAqL1xuICB2YXIgcmVpbml0Q29va2llU2hpcHBpbmdFbGlnaWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb29raWVTaGlwcGluZ0VsaWdpYmxlID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCdmc2hpcEVsaWdpYmxlJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdmVyaWZ5U2hpcHBpbmdCeVppcGNvZGVcbiAgICogTWlkZGxlIGZ1bmN0aW9uIGNhbGxlZCBieSBjb2xvckZsYXZvclNpemUgY2hhbmdlcywgYW5kIHNlbmQgYSByZXF1ZXN0IHRvIEZyZWVTaGlwcGluZyBBUElcbiAgICogQHBhcmFtICB7fVxuICAgKi9cbiAgdmFyIHZlcmlmeVNoaXBwaW5nQnlaaXBjb2RlID0gZnVuY3Rpb24gKGNvbnRlbnQsIHByb3BlcnRpZXMsIGVsZW1lbnQpIHtcbiAgICB2YXIgYnV5QnRuLCBjb250YWluZXIsIHByb3AsIHNrdSwgc2VsbGVySWQ7XG4gICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgIHZhciB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICB0ZW1wLmlubmVySFRNTCA9IGNvbnRlbnQ7XG4gICAgICBjb250YWluZXIgPSB0ZW1wLmZpcnN0RWxlbWVudENoaWxkO1xuICAgICAgYnV5QnRuID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5idXktYnV0dG9uLW5vdy5idXR0b24tbm8tZmxvYXRbZGF0YS1za3UqPVwiLVwiXScpO1xuICAgICAgcHJvcCA9IHByb3BlcnRpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1eUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXktYnV0dG9uLW5vdy5idXR0b24tbm8tZmxvYXRbZGF0YS1za3UqPVwiLVwiXScpO1xuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J1eS1ib3gnKTtcbiAgICB9XG5cbiAgICBpZiAoYnV5QnRuKSB7XG4gICAgICBza3UgPSBidXlCdG4uZ2V0QXR0cmlidXRlKCdkYXRhLXNrdScpO1xuICAgICAgc2VsbGVySWQgPSBidXlCdG4uZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGxlcicpO1xuICAgIH1cblxuICAgIGlmIChjb29raWVTaGlwcGluZ0VsaWdpYmxlID09PSAndHJ1ZScgJiYgYnV5QnRuKSB7XG5cbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YigndmVyaWZ5RnJlZVNoaXBwaW5nJywgc2t1LCBzZWxsZXJJZCwgY29va2llWmlwY29kZSwgY29udGFpbmVyLCBwcm9wLCBlbGVtZW50KTtcbiAgICB9IGVsc2UgaWYgKGNvb2tpZVNoaXBwaW5nRWxpZ2libGUgPT09ICdmYWxzZScpIHtcblxuICAgICAgaWYgKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpKSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZyZWVEZWxpdmVyeS1jb250YWluZXInKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG5cbiAgICAgIGlmIChjb250ZW50KSB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVybkNoZWNrZWRGcmVlU2hpcHBpbmcnLCBwcm9wLCBjb250YWluZXIsIGVsZW1lbnQpO1xuXG4gICAgICB1cGRhdGVMb2FkaW5nU3RhdGUoKTtcblxuICAgIH0gZWxzZSBpZiAoKCFjb29raWVTaGlwcGluZ0VsaWdpYmxlICYmIHR5cGVvZiBjb29raWVTaGlwcGluZ0VsaWdpYmxlID09PSAnc3RyaW5nJykgfHwgIWJ1eUJ0bikge1xuXG4gICAgICBpZiAoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktY29udGFpbmVyJykpIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcblxuICAgICAgaWYgKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWdpZicpKSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZyZWVEZWxpdmVyeS1naWYnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICBpZiAoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktY29udGFpbmVyIC5ucy1pY29uLWZyZWUtc2hpcHBpbmcnKSkge1xuICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZyZWVEZWxpdmVyeS1jb250YWluZXIgLm5zLWljb24tZnJlZS1zaGlwcGluZycpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktY29udGFpbmVyIC50YWctc2hpcHBpbmcubmV3LXRhZycpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIH1cblxuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCduc0xvYWRpbmcuaGlkZScsIGRvY3VtZW50LmJvZHkpO1xuXG4gICAgICBpZiAoY29udGVudCkgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdyZXR1cm5DaGVja2VkRnJlZVNoaXBwaW5nJywgcHJvcCwgY29udGFpbmVyLCBlbGVtZW50KTtcbiAgICB9XG4gIH07XG5cbiAgLy9Jbml0aWFsaXplXG4gIHRyeSB7XG4gICAgRnJlZURlbGl2ZXJ5LmluaXQoKTtcblxuICAgIC8vIEluaXQgdmVyaWZ5U2hpcHBpbmdCeVppcGNvZGUgZnVuY3Rpb24gYW5kIGxpc3RlbiBldmVudHMgZm9yIEZyZWVTaGlwcGluZyBBUEkgaW4gUHJvZHVjdCBQYWdlc1xuICAgIGlmIChjaGVja0ZyZWVTaGlwcGluZ0VuYWJsZWQgJiYgZGF0YUxheWVyWzBdLnBhZ2UucGFnZUlELnRvTG93ZXJDYXNlKCkgPT09ICdwcm9kdWN0Jykge1xuICAgICAgaWYgKGNvb2tpZVNoaXBwaW5nRWxpZ2libGUgPT09ICd0cnVlJykge1xuICAgICAgICB2ZXJpZnlTaGlwcGluZ0J5WmlwY29kZSgpO1xuICAgICAgfSBlbHNlIGlmIChjb29raWVTaGlwcGluZ0VsaWdpYmxlID09PSAnZmFsc2UnKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpKSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIH0gZWxzZSBpZiAoIWNvb2tpZVNoaXBwaW5nRWxpZ2libGUgJiYgdHlwZW9mIGNvb2tpZVNoaXBwaW5nRWxpZ2libGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpKSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktY29udGFpbmVyIC5ucy1pY29uLWZyZWUtc2hpcHBpbmcnKSkge1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktY29udGFpbmVyIC5ucy1pY29uLWZyZWUtc2hpcHBpbmcnKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZyZWVEZWxpdmVyeS1jb250YWluZXIgLnRhZy1zaGlwcGluZy5uZXctdGFnJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghY2hlY2tGcmVlU2hpcHBpbmdFbmFibGVkICYmIGRhdGFMYXllclswXS5wYWdlLnBhZ2VJRC50b0xvd2VyQ2FzZSgpID09PSAncHJvZHVjdCcpIHtcbiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpKSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICB9XG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdjaGFuZ2UuQ29sb3JGbGF2b3JTaXplLmZyZWVTaGlwcGluZycsIHZlcmlmeVNoaXBwaW5nQnlaaXBjb2RlKTtcbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3JldHVyblNoaXBwaW5nRWxpZ2liaWxpdHkuUERQJywgdmVyaWZ5U2hpcHBpbmdCeVppcGNvZGUpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignemlwY29kZUNvb2tpZS5yZWluaXQnLCByZWluaXRaaXBjb2RlQ29va2llKTtcbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3NoaXBwaW5nRWxpZ2libGVDb29raWUucmVpbml0JywgcmVpbml0Q29va2llU2hpcHBpbmdFbGlnaWJsZSk7XG5cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcignRVJST1IgfCBGcmVlRGVsaXZlcnkgUERQJyArIGVycik7XG4gIH1cbn0oKSk7XG4iXX0=
