"use strict";var cluster=function(){var e=window.freedom.getCookie("clusterId")?decodeURIComponent(window.freedom.getCookie("clusterId")):void 0,t=window.freedom.getCookie("uuid")||void 0,o=window.freedom.getCookie("sotreId")||void 0,n=window.freedom.getCookie("uf")||void 0,r=window.freedom.getCookie("cityCode")||void 0,i=window.freedom.getCookie("zipcode")||void 0,l=document.querySelector("section[data-free-shipping-by-zipcode]"),a=document.querySelector("section[data-get-zipcode-info]"),m=function(e){var t="";return e&&(t=e.filter(function(e){return e.mainAddress===!0})[0]),t},d=function(e,t){return e.reduce(function(e,o,n){return 0===n?e+o[t]:e+","+o[t]},"")},c=function(e,t,o){var n="expires=";o.setTime(o.getTime()+432e5),n+=o.toGMTString(),document.cookie=e+"="+t+"; "+n+"; path=/"},u=function(e,t,o){return e&&!e.includes("anonymous")&&(!t||!o)},g={banner_stripe_home:"banner-stripe-home",home_gamma_full_top_0:"home-gamma-full-top-0",home_gamma_killers_list:"home-gamma-killers-list",home_gamma_triple_line1_rectangle_0:"home-gamma-triple-line1-rectangle-0",home_gamma_triple_line1_rectangle_1:"home-gamma-triple-line1-rectangle-1",home_gamma_categories_list:"home-gamma-categories-list",home_gamma_triple_line2_rectangle_0:"home-gamma-triple-line2-rectangle-0",home_gamma_triple_line2_rectangle_1:"home-gamma-triple-line2-rectangle-1",home_gamma_triple_line2_rectangle_2:"home-gamma-triple-line2-rectangle-3",home_gamma_brands_list:"home-gamma-brands-list",home_gamma_full_buttons_line1:"home-gamma-full-buttons-line1",home_gamma_triple_line3_rectangle:"home-gamma-triple-line3-rectangle",home_gamma_banners_carousel_top:"home-gamma-banners-carousel-top",home_gamma_banners_carousel_middle:"home-gamma-banners-carousel-middle",home_gamma_banners_carousel_middle_2:"home-gamma-banners-carousel-middle-2",home_gamma_banners_carousel_bottom:"home-gamma-banners-carousel-bottom",banner_stripe_pdp:"banner-stripe-pdp",banner_stripe_search:"banner-stripe-search",banner_html_pdp:"banner-html-pdp"},s={banner_stripe_home:"banner-stripe-home",banner_stripe_pdp:"banner-stripe-pdp",banner_stripe_search:"banner-stripe-search",zt_home_triple_line3_rectangle_0:"zt-home-triple-line3-rectangle-0",zt_home_triple_line3_rectangle_1:"zt-home-triple-line3-rectangle-1",zt_home_triple_line3_rectangle_2:"zt-home-triple-line3-rectangle-2",zt_home_full_top_0:"zt-home-full-top-0",zt_home_triple_line1_rectangle_0:"zt-home-triple-line1-rectangle-0",zt_home_triple_line1_rectangle_1:"zt-home-triple-line1-rectangle-1",zt_home_triple_line2_rectangle_0:"zt-home-triple-line2-rectangle-0",zt_home_triple_line2_rectangle_1:"zt-home-triple-line2-rectangle-1",zt_home_triple_line2_rectangle_2:"zt-home-triple-line2-rectangle-2",home_gamma_full_buttons_line1:"home-gamma-full-buttons-line1",zt_home_full_top:"zt-home-full-top",zt_home_full_middle:"zt-home-full-middle",zt_home_full_bottom:"zt-home-full-bottom",zt_home_banner_fixe1:"zt-home-banner-fixe1",zt_home_banner_fixe2:"zt-home-banner-fixe2",banner_html_pdp:"banner-html-pdp"},_=function(){l?window.zipcodeAPIsAjax?window.freedom.nsPubSub.pub("nsLoading.hide",document.body):window.zipcodeAPIsAjax=!0:window.freedom.nsPubSub.pub("nsLoading.hide",document.body)},p=function(){document.querySelectorAll(".ghost-wrapper")&&document.querySelectorAll(".ghost-wrapper").length>0&&document.querySelectorAll(".ghost-wrapper").forEach(function(e){e.querySelectorAll("a img")&&e.querySelectorAll("a img").length>0?e.querySelectorAll("a img").forEach(function(t){var o=setInterval(function(){t.complete&&(e.classList.remove("ghost-wrapper"),clearInterval(o))},250)}):e.classList.remove("ghost-wrapper")}),_()},h=function(e,t,o,n,r){"home-gamma-full-top-0"!==e[t]&&"zt-home-full-top-0"!==e[t]||!document.getElementById(e[t])||(document.getElementById(e[t]).querySelectorAll("a img").forEach(function(e){e.removeAttribute("data-campaign-interactive"),e.removeAttribute("data-banner-interactive")}),setTimeout(function(){document.getElementById(e[t])&&document.getElementById(e[t]).querySelectorAll(".bullet")&&document.getElementById(e[t]).querySelectorAll(".bullet").forEach(function(e){e.classList.add("hide")})},500)),o<=n&&e[t]&&document.getElementById(e[t])&&document.getElementById(e[t]).querySelectorAll("a img")&&document.getElementById(e[t]).querySelectorAll("a img").forEach(function(e,t){(r.data.images&&r.data.images[t]||r.data.urlImage)&&(e.src=r.data.images?r.data.images[t].urlImage:r.data.urlImage,e.parentNode.href=r.data.images?r.data.images[t].urlTarget:r.data.urlTarget)})},f=function(e,t,o){if(document.getElementById(e[t])){var n=window.freedom.getCookie("uname")||"",r=o.data.content;r=r.replace("{username}",decodeURI(n)),r=r.replace("{clusterName}",""),document.getElementById(e[t]).innerHTML="",document.getElementById(e[t]).innerHTML=r}},b=function(e){e&&e.length>0&&e.forEach(function(e){var t=window.freedom.getCookie("storeId")&&"L_ZATTINI"===window.freedom.getCookie("storeId")?s:g,o=e.id.replace(/-/g,"_"),n=e.data.images?e.data.images.length:1,r=document.getElementById(t[o])?document.getElementById(t[o]).querySelectorAll("a img").length:0;"HTML"===e.data.type?f(t,o,e):h(t,o,n,r,e)}),p()},w=function(){if(e&&!e.includes("anonymous")||"string"==typeof n||"string"==typeof r){var t=window.freedom.getCookie("campaignCode")||"",o=e||null,i=a?n||null:null,l=a?r||null:null,m="/banner/usercluster/"+o+"/uf/"+i+"/city/"+l+"/"+t,d={method:"get",type:"json",success:function(e){b(e)},error:function(e){console.error(e),p()}};window.freedom.restClient.request(m,d)}else p()},y=function(){e=decodeURIComponent(window.freedom.getCookie("clusterId"))||void 0,t=window.freedom.getCookie("uuid")||void 0,o=window.freedom.getCookie("sotreId")||void 0,n="string"==typeof window.freedom.getCookie("uf")?window.freedom.getCookie("uf"):void 0,r="string"==typeof window.freedom.getCookie("cityCode")?window.freedom.getCookie("cityCode"):void 0,i=window.freedom.getCookie("zipcode")||void 0,w()},z=function(e){var t=e||{},o=t.clusters?d(t.clusters,"id"):"",n=m(t.addresses),r=new Date;o?c("clusterId",o,r):c("clusterId","anonymous",r),n?(n.zipCode&&(c("zipcode",n.zipCode,r),window.freedom.nsPubSub.pub("changeHeaderZipcode",n.zipCode)),window.freedom.nsPubSub.pub("getZipcodeFullInfo",n.zipCode,!0)):y()},I=function(){if(u(t,e,i)){var l={method:"get",type:"json",headers:{uuid:t,storeId:o},success:function(e){z(e)},error:function(e){console.error(e),w()}};window.freedom.restClient.request("/soft-login?cluster=true",l)}else!a||n&&r||!e||!i?w():window.freedom.nsPubSub.pub("getZipcodeFullInfo",i)};try{I(),window.freedom.nsPubSub.sub("getSegmentationBanners",y),console.log("=========ZIP")}catch(C){console.error("Error trying to get logged user info and generate cookies",C)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9fYmVoYXZpb3IvYmFubmVyLWFqYXgvYWxsL2Jhbm5lci1hamF4Lm1pbi5qcyJdLCJuYW1lcyI6WyJjbHVzdGVyIiwiVVNFUl9DTFVTVEVSIiwid2luZG93IiwiZnJlZWRvbSIsImdldENvb2tpZSIsImRlY29kZVVSSUNvbXBvbmVudCIsInVuZGVmaW5lZCIsIlVVSUQiLCJTVE9SRV9JRCIsIkFERFJFU1NfVUYiLCJBRERSRVNTX0NJVFkiLCJaSVBDT0RFIiwiY2hlY2tGcmVlU2hpcHBpbmdFbmFibGVkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZ2V0WmlwY29kZUluZm9FbmFibGVkIiwiZ2V0TWFpbkFkZHJlc3MiLCJhZGRyZXNzZXMiLCJtYWluIiwiZmlsdGVyIiwiYWRkcmVzcyIsIm1haW5BZGRyZXNzIiwiY29uY2F0Q2x1c3RlcnNQcm9wIiwiY2x1c3RlcnMiLCJwcm9wZXJ0eSIsInJlZHVjZSIsImFjYyIsImVsIiwiaW5kZXgiLCJzZXRDb29raWUiLCJuYW1lIiwidmFsdWUiLCJkYXRlIiwiZXhwaXJlcyIsInNldFRpbWUiLCJnZXRUaW1lIiwidG9HTVRTdHJpbmciLCJjb29raWUiLCJzaG91bGRMb2FkVXNlciIsInV1aWQiLCJjbHVzdGVySWQiLCJ6aXBDb2RlIiwiaW5jbHVkZXMiLCJsaXN0QmFubmVyc0lkTmV0c2hvZXMiLCJiYW5uZXJfc3RyaXBlX2hvbWUiLCJob21lX2dhbW1hX2Z1bGxfdG9wXzAiLCJob21lX2dhbW1hX2tpbGxlcnNfbGlzdCIsImhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUxX3JlY3RhbmdsZV8wIiwiaG9tZV9nYW1tYV90cmlwbGVfbGluZTFfcmVjdGFuZ2xlXzEiLCJob21lX2dhbW1hX2NhdGVnb3JpZXNfbGlzdCIsImhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8wIiwiaG9tZV9nYW1tYV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzEiLCJob21lX2dhbW1hX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMiIsImhvbWVfZ2FtbWFfYnJhbmRzX2xpc3QiLCJob21lX2dhbW1hX2Z1bGxfYnV0dG9uc19saW5lMSIsImhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZSIsImhvbWVfZ2FtbWFfYmFubmVyc19jYXJvdXNlbF90b3AiLCJob21lX2dhbW1hX2Jhbm5lcnNfY2Fyb3VzZWxfbWlkZGxlIiwiaG9tZV9nYW1tYV9iYW5uZXJzX2Nhcm91c2VsX21pZGRsZV8yIiwiaG9tZV9nYW1tYV9iYW5uZXJzX2Nhcm91c2VsX2JvdHRvbSIsImJhbm5lcl9zdHJpcGVfcGRwIiwiYmFubmVyX3N0cmlwZV9zZWFyY2giLCJiYW5uZXJfaHRtbF9wZHAiLCJsaXN0QmFubmVyc0lkWmF0dGluaSIsInp0X2hvbWVfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZV8wIiwienRfaG9tZV90cmlwbGVfbGluZTNfcmVjdGFuZ2xlXzEiLCJ6dF9ob21lX3RyaXBsZV9saW5lM19yZWN0YW5nbGVfMiIsInp0X2hvbWVfZnVsbF90b3BfMCIsInp0X2hvbWVfdHJpcGxlX2xpbmUxX3JlY3RhbmdsZV8wIiwienRfaG9tZV90cmlwbGVfbGluZTFfcmVjdGFuZ2xlXzEiLCJ6dF9ob21lX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMCIsInp0X2hvbWVfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8xIiwienRfaG9tZV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzIiLCJ6dF9ob21lX2Z1bGxfdG9wIiwienRfaG9tZV9mdWxsX21pZGRsZSIsInp0X2hvbWVfZnVsbF9ib3R0b20iLCJ6dF9ob21lX2Jhbm5lcl9maXhlMSIsInp0X2hvbWVfYmFubmVyX2ZpeGUyIiwidXBkYXRlTG9hZGluZ1N0YXRlIiwiemlwY29kZUFQSXNBamF4IiwibnNQdWJTdWIiLCJwdWIiLCJib2R5IiwicmVtb3ZlUGxhY2Vob2xkZXJCYW5uZXIiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGVuZ3RoIiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpbWFnZSIsInJlbW92ZVBsYWNlaG9sZGVyIiwic2V0SW50ZXJ2YWwiLCJjb21wbGV0ZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsImNsZWFySW50ZXJ2YWwiLCJjaGFuZ2VCYW5uZXJzSW1hZ2UiLCJsaXN0QmFubmVyc0lkIiwiYmFubmVySWQiLCJiYW5uZXJzQ2x1c3RlcklkQ291bnQiLCJjdXJyZW50QmFubmVyQ291bnQiLCJiYW5uZXJJdGVtIiwiZ2V0RWxlbWVudEJ5SWQiLCJpbWciLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRUaW1lb3V0IiwiaXRlbSIsImFkZCIsImRhdGEiLCJpbWFnZXMiLCJ1cmxJbWFnZSIsInNyYyIsInBhcmVudE5vZGUiLCJocmVmIiwidXJsVGFyZ2V0IiwiY2hhbmdlQmFubmVyc0h0bWwiLCJ1c2VybmFtZSIsImJhbm5lckNvbnRlbnQiLCJjb250ZW50IiwicmVwbGFjZSIsImRlY29kZVVSSSIsImlubmVySFRNTCIsImNoYW5nZUJhbm5lcnMiLCJiYW5uZXJzQXJyYXkiLCJpZCIsInR5cGUiLCJnZXRCYW5uZXJzIiwiY2FtcGFpZ24iLCJ1ZiIsImNpdHlDb2RlIiwidXJsIiwib3B0aW9ucyIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJlcnJvciIsImNvbnNvbGUiLCJyZXN0Q2xpZW50IiwicmVxdWVzdCIsInJlaW5pdFZhcmlhYmxlcyIsInNldENvb2tpZXMiLCJyZXNwb25zZSIsIkRhdGUiLCJnZXRMb2dnZWRVc2VyQW5kR2VuZXJhdGVDb29raWVzIiwiaGVhZGVycyIsInN0b3JlSWQiLCJzdWIiLCJsb2ciXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBSUEsU0FBVyxXQUNiLEdBQUlDLEdBQWVDLE9BQU9DLFFBQVFDLFVBQVUsYUFBZUMsbUJBQW1CSCxPQUFPQyxRQUFRQyxVQUFVLGNBQWdCRSxPQUNySEMsRUFBT0wsT0FBT0MsUUFBUUMsVUFBVSxTQUFXRSxPQUMzQ0UsRUFBV04sT0FBT0MsUUFBUUMsVUFBVSxZQUFjRSxPQUNsREcsRUFBYVAsT0FBT0MsUUFB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SSxxQkFBc0J0RSxHQU94RCxLQUNFbUksSUFDQTVJLE9BQU9DLFFBQVE2RSxTQUFTaUUsSUFBSSx5QkFBMEJQLEdBQ3RESCxRQUFRVyxJQUFJLGdCQUNaLE1BQU9aLEdBQ1BDLFFBQVFELE1BQU0sNERBQTZEQSIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX2NvbXBvbmVudHMvX2JlaGF2aW9yL2Jhbm5lci1hamF4L2FsbC9iYW5uZXItYWpheC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBjbHVzdGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgdmFyIFVTRVJfQ0xVU1RFUiA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnY2x1c3RlcklkJykgPyBkZWNvZGVVUklDb21wb25lbnQod2luZG93LmZyZWVkb20uZ2V0Q29va2llKCdjbHVzdGVySWQnKSkgOiB1bmRlZmluZWQsXG4gICAgVVVJRCA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgndXVpZCcpIHx8IHVuZGVmaW5lZCxcbiAgICBTVE9SRV9JRCA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc290cmVJZCcpIHx8IHVuZGVmaW5lZCxcbiAgICBBRERSRVNTX1VGID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCd1ZicpIHx8IHVuZGVmaW5lZCxcbiAgICBBRERSRVNTX0NJVFkgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ2NpdHlDb2RlJykgfHwgdW5kZWZpbmVkLFxuICAgIFpJUENPREUgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3ppcGNvZGUnKSB8fCB1bmRlZmluZWQ7XG5cbiAgLy8gdGhpcyB2YXIgY2hlY2sgaWYgW2dldC16aXBjb2RlLWluZm9dIG9yIFtmcmVlLXNoaXBwaW5nXSBpcyBlbmFibGVkLCBiZWNhdXNlIHRoZSBbaW5zZXJ0LXppcC1jb2RlXSBpbnRlcmFjdCB3aXRoIGJvdGggQVBJc1xuICAvLyBpdCB3YXMgbmVlZCB0d28gc3luYyB0aGUgbnNMb2FkaW5nIHN0YXRlIG9uIHRoZSBjYWxsYmFjayBmdW5jIG9mIGJvdGggZmVhdHVyZXMgXG4gIHZhciBjaGVja0ZyZWVTaGlwcGluZ0VuYWJsZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzZWN0aW9uW2RhdGEtZnJlZS1zaGlwcGluZy1ieS16aXBjb2RlXScpLFxuICAgIGdldFppcGNvZGVJbmZvRW5hYmxlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb25bZGF0YS1nZXQtemlwY29kZS1pbmZvXScpO1xuXG4gIHZhciBnZXRNYWluQWRkcmVzcyA9IGZ1bmN0aW9uIChhZGRyZXNzZXMpIHtcbiAgICB2YXIgbWFpbiA9ICcnO1xuICAgIGlmIChhZGRyZXNzZXMpIHtcbiAgICAgIG1haW4gPSBhZGRyZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiBhZGRyZXNzLm1haW5BZGRyZXNzID09PSB0cnVlO1xuICAgICAgfSlbMF07XG4gICAgfVxuICAgIHJldHVybiBtYWluO1xuICB9O1xuXG4gIHZhciBjb25jYXRDbHVzdGVyc1Byb3AgPSBmdW5jdGlvbiAoY2x1c3RlcnMsIHByb3BlcnR5KSB7XG4gICAgcmV0dXJuIGNsdXN0ZXJzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBlbCwgaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCA9PT0gMCkgcmV0dXJuIGFjYyArIGVsW3Byb3BlcnR5XTtcbiAgICAgIHJldHVybiBhY2MgKyAnLCcgKyBlbFtwcm9wZXJ0eV07XG4gICAgfSwgJycpO1xuICB9O1xuXG4gIHZhciBzZXRDb29raWUgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGRhdGUpIHtcbiAgICB2YXIgZXhwaXJlcyA9ICdleHBpcmVzPSc7XG4gICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKDEyICogNjAgKiA2MCAqIDEwMDApKTtcbiAgICBleHBpcmVzICs9IGRhdGUudG9HTVRTdHJpbmcoKTtcbiAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgJz0nICsgdmFsdWUgKyAnOyAnICsgZXhwaXJlcyArICc7IHBhdGg9Lyc7XG4gIH07XG5cbiAgdmFyIHNob3VsZExvYWRVc2VyID0gZnVuY3Rpb24gKHV1aWQsIGNsdXN0ZXJJZCwgemlwQ29kZSkge1xuICAgIHJldHVybiB1dWlkICYmICF1dWlkLmluY2x1ZGVzKCdhbm9ueW1vdXMnKSAmJiAoIWNsdXN0ZXJJZCB8fCAhemlwQ29kZSk7XG4gIH07XG5cbiAgdmFyIGxpc3RCYW5uZXJzSWROZXRzaG9lcyA9IHtcbiAgICBiYW5uZXJfc3RyaXBlX2hvbWU6ICdiYW5uZXItc3RyaXBlLWhvbWUnLFxuICAgIGhvbWVfZ2FtbWFfZnVsbF90b3BfMDogJ2hvbWUtZ2FtbWEtZnVsbC10b3AtMCcsXG4gICAgaG9tZV9nYW1tYV9raWxsZXJzX2xpc3Q6ICdob21lLWdhbW1hLWtpbGxlcnMtbGlzdCcsXG4gICAgaG9tZV9nYW1tYV90cmlwbGVfbGluZTFfcmVjdGFuZ2xlXzA6ICdob21lLWdhbW1hLXRyaXBsZS1saW5lMS1yZWN0YW5nbGUtMCcsXG4gICAgaG9tZV9nYW1tYV90cmlwbGVfbGluZTFfcmVjdGFuZ2xlXzE6ICdob21lLWdhbW1hLXRyaXBsZS1saW5lMS1yZWN0YW5nbGUtMScsXG4gICAgaG9tZV9nYW1tYV9jYXRlZ29yaWVzX2xpc3Q6ICdob21lLWdhbW1hLWNhdGVnb3JpZXMtbGlzdCcsXG4gICAgaG9tZV9nYW1tYV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzA6ICdob21lLWdhbW1hLXRyaXBsZS1saW5lMi1yZWN0YW5nbGUtMCcsXG4gICAgaG9tZV9nYW1tYV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzE6ICdob21lLWdhbW1hLXRyaXBsZS1saW5lMi1yZWN0YW5nbGUtMScsXG4gICAgaG9tZV9nYW1tYV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzI6ICdob21lLWdhbW1hLXRyaXBsZS1saW5lMi1yZWN0YW5nbGUtMycsXG4gICAgaG9tZV9nYW1tYV9icmFuZHNfbGlzdDogJ2hvbWUtZ2FtbWEtYnJhbmRzLWxpc3QnLFxuICAgIGhvbWVfZ2FtbWFfZnVsbF9idXR0b25zX2xpbmUxOiAnaG9tZS1nYW1tYS1mdWxsLWJ1dHRvbnMtbGluZTEnLFxuICAgIGhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZTogJ2hvbWUtZ2FtbWEtdHJpcGxlLWxpbmUzLXJlY3RhbmdsZScsXG4gICAgaG9tZV9nYW1tYV9iYW5uZXJzX2Nhcm91c2VsX3RvcDogJ2hvbWUtZ2FtbWEtYmFubmVycy1jYXJvdXNlbC10b3AnLFxuICAgIGhvbWVfZ2FtbWFfYmFubmVyc19jYXJvdXNlbF9taWRkbGU6ICdob21lLWdhbW1hLWJhbm5lcnMtY2Fyb3VzZWwtbWlkZGxlJyxcbiAgICBob21lX2dhbW1hX2Jhbm5lcnNfY2Fyb3VzZWxfbWlkZGxlXzI6ICdob21lLWdhbW1hLWJhbm5lcnMtY2Fyb3VzZWwtbWlkZGxlLTInLFxuICAgIGhvbWVfZ2FtbWFfYmFubmVyc19jYXJvdXNlbF9ib3R0b206ICdob21lLWdhbW1hLWJhbm5lcnMtY2Fyb3VzZWwtYm90dG9tJyxcbiAgICBiYW5uZXJfc3RyaXBlX3BkcDogJ2Jhbm5lci1zdHJpcGUtcGRwJyxcbiAgICBiYW5uZXJfc3RyaXBlX3NlYXJjaDogJ2Jhbm5lci1zdHJpcGUtc2VhcmNoJyxcbiAgICBiYW5uZXJfaHRtbF9wZHA6ICdiYW5uZXItaHRtbC1wZHAnXG4gIH07XG5cbiAgdmFyIGxpc3RCYW5uZXJzSWRaYXR0aW5pID0ge1xuICAgIGJhbm5lcl9zdHJpcGVfaG9tZTogJ2Jhbm5lci1zdHJpcGUtaG9tZScsXG4gICAgYmFubmVyX3N0cmlwZV9wZHA6ICdiYW5uZXItc3RyaXBlLXBkcCcsXG4gICAgYmFubmVyX3N0cmlwZV9zZWFyY2g6ICdiYW5uZXItc3RyaXBlLXNlYXJjaCcsXG4gICAgenRfaG9tZV90cmlwbGVfbGluZTNfcmVjdGFuZ2xlXzA6ICd6dC1ob21lLXRyaXBsZS1saW5lMy1yZWN0YW5nbGUtMCcsXG4gICAgenRfaG9tZV90cmlwbGVfbGluZTNfcmVjdGFuZ2xlXzE6ICd6dC1ob21lLXRyaXBsZS1saW5lMy1yZWN0YW5nbGUtMScsXG4gICAgenRfaG9tZV90cmlwbGVfbGluZTNfcmVjdGFuZ2xlXzI6ICd6dC1ob21lLXRyaXBsZS1saW5lMy1yZWN0YW5nbGUtMicsXG4gICAgenRfaG9tZV9mdWxsX3RvcF8wOiBcInp0LWhvbWUtZnVsbC10b3AtMFwiLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUxX3JlY3RhbmdsZV8wOiAnenQtaG9tZS10cmlwbGUtbGluZTEtcmVjdGFuZ2xlLTAnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUxX3JlY3RhbmdsZV8xOiAnenQtaG9tZS10cmlwbGUtbGluZTEtcmVjdGFuZ2xlLTEnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8wOiAnenQtaG9tZS10cmlwbGUtbGluZTItcmVjdGFuZ2xlLTAnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8xOiAnenQtaG9tZS10cmlwbGUtbGluZTItcmVjdGFuZ2xlLTEnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8yOiAnenQtaG9tZS10cmlwbGUtbGluZTItcmVjdGFuZ2xlLTInLFxuICAgIGhvbWVfZ2FtbWFfZnVsbF9idXR0b25zX2xpbmUxOiAnaG9tZS1nYW1tYS1mdWxsLWJ1dHRvbnMtbGluZTEnLFxuICAgIHp0X2hvbWVfZnVsbF90b3A6ICd6dC1ob21lLWZ1bGwtdG9wJyxcbiAgICB6dF9ob21lX2Z1bGxfbWlkZGxlOiAnenQtaG9tZS1mdWxsLW1pZGRsZScsXG4gICAgenRfaG9tZV9mdWxsX2JvdHRvbTogJ3p0LWhvbWUtZnVsbC1ib3R0b20nLFxuICAgIHp0X2hvbWVfYmFubmVyX2ZpeGUxOiAnenQtaG9tZS1iYW5uZXItZml4ZTEnLFxuICAgIHp0X2hvbWVfYmFubmVyX2ZpeGUyOiAnenQtaG9tZS1iYW5uZXItZml4ZTInLFxuICAgIGJhbm5lcl9odG1sX3BkcDogJ2Jhbm5lci1odG1sLXBkcCdcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCB1cGRhdGVMb2FkaW5nU3RhdGVcbiAgICogRnVuY3Rpb24gdG8gc3luYyB0aGUgbnNMb2FkaW5nIHN0YXRlIG9uIHRoZSBjYWxsYmFjayBmdW5jIG9mIHdoZW4gY2hhbmdlIHRoZSB6aXBjb2RlIG9uIFtpbnNlcnQtemlwLWNvZGVdXG4gICAqIFtmcmVlLXNoaXBwaW5nXSBhbmQgW2dldC16aXBjb2RlLWluZm9dIHJlc3BvbmRzIG9uIHppcGNvZGUgY29va2llIGNoYW5nZXNcbiAgICovXG4gIHZhciB1cGRhdGVMb2FkaW5nU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGNoZWNrRnJlZVNoaXBwaW5nRW5hYmxlZCkge1xuICAgICAgaWYgKHdpbmRvdy56aXBjb2RlQVBJc0FqYXgpIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCduc0xvYWRpbmcuaGlkZScsIGRvY3VtZW50LmJvZHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LnppcGNvZGVBUElzQWpheCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbnNMb2FkaW5nLmhpZGUnLCBkb2N1bWVudC5ib2R5KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcmVtb3ZlUGxhY2Vob2xkZXJCYW5uZXJcbiAgICovXG4gIHZhciByZW1vdmVQbGFjZWhvbGRlckJhbm5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdob3N0LXdyYXBwZXInKSAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ2hvc3Qtd3JhcHBlcicpLmxlbmd0aCA+IDApIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5naG9zdC13cmFwcGVyJykuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhIGltZycpICYmIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhIGltZycpLmZvckVhY2goZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlUGxhY2Vob2xkZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmIChpbWFnZS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZ2hvc3Qtd3JhcHBlcicpO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmVtb3ZlUGxhY2Vob2xkZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAyNTApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZ2hvc3Qtd3JhcHBlcicpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB1cGRhdGVMb2FkaW5nU3RhdGUoKTtcbiAgfTtcblxuICB2YXIgY2hhbmdlQmFubmVyc0ltYWdlID0gZnVuY3Rpb24gKGxpc3RCYW5uZXJzSWQsIGJhbm5lcklkLCBiYW5uZXJzQ2x1c3RlcklkQ291bnQsIGN1cnJlbnRCYW5uZXJDb3VudCwgYmFubmVySXRlbSkge1xuXG4gICAgaWYgKChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSA9PT0gJ2hvbWUtZ2FtbWEtZnVsbC10b3AtMCcgfHwgbGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0gPT09ICd6dC1ob21lLWZ1bGwtdG9wLTAnKSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkpIHtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RCYW5uZXJzSWRbYmFubmVySWRdKS5xdWVyeVNlbGVjdG9yQWxsKCdhIGltZycpLmZvckVhY2goZnVuY3Rpb24gKGltZykge1xuICAgICAgICBpbWcucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWNhbXBhaWduLWludGVyYWN0aXZlJyk7XG4gICAgICAgIGltZy5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtYmFubmVyLWludGVyYWN0aXZlJyk7XG4gICAgICB9KTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0pICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RCYW5uZXJzSWRbYmFubmVySWRdKS5xdWVyeVNlbGVjdG9yQWxsKCcuYnVsbGV0JykpIHtcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnLmJ1bGxldCcpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LCA1MDApO1xuICAgIH1cbiAgICBpZiAoYmFubmVyc0NsdXN0ZXJJZENvdW50IDw9IGN1cnJlbnRCYW5uZXJDb3VudCAmJiBsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkge1xuICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RCYW5uZXJzSWRbYmFubmVySWRdKSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKSkge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xuICAgICAgICAgIGlmIChiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzICYmIGJhbm5lckl0ZW0uZGF0YS5pbWFnZXNbaW5kZXhdIHx8IGJhbm5lckl0ZW0uZGF0YS51cmxJbWFnZSkge1xuICAgICAgICAgICAgaXRlbS5zcmMgPSBiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzID8gYmFubmVySXRlbS5kYXRhLmltYWdlc1tpbmRleF0udXJsSW1hZ2UgOiBiYW5uZXJJdGVtLmRhdGEudXJsSW1hZ2U7XG4gICAgICAgICAgICBpdGVtLnBhcmVudE5vZGUuaHJlZiA9IGJhbm5lckl0ZW0uZGF0YS5pbWFnZXMgPyBiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzW2luZGV4XS51cmxUYXJnZXQgOiBiYW5uZXJJdGVtLmRhdGEudXJsVGFyZ2V0O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciBjaGFuZ2VCYW5uZXJzSHRtbCA9IGZ1bmN0aW9uIChsaXN0QmFubmVyc0lkLCBiYW5uZXJJZCwgYmFubmVySXRlbSkge1xuICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkpIHtcbiAgICAgIHZhciB1c2VybmFtZSA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgndW5hbWUnKSB8fCAnJztcbiAgICAgIHZhciBiYW5uZXJDb250ZW50ID0gYmFubmVySXRlbS5kYXRhLmNvbnRlbnQ7XG5cbiAgICAgIGJhbm5lckNvbnRlbnQgPSBiYW5uZXJDb250ZW50LnJlcGxhY2UoJ3t1c2VybmFtZX0nLCBkZWNvZGVVUkkodXNlcm5hbWUpKTtcbiAgICAgIGJhbm5lckNvbnRlbnQgPSBiYW5uZXJDb250ZW50LnJlcGxhY2UoJ3tjbHVzdGVyTmFtZX0nLCAnJyk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RCYW5uZXJzSWRbYmFubmVySWRdKS5pbm5lckhUTUwgPSBiYW5uZXJDb250ZW50O1xuICAgIH1cbiAgfTtcblxuICB2YXIgY2hhbmdlQmFubmVycyA9IGZ1bmN0aW9uIChiYW5uZXJzQXJyYXkpIHtcbiAgICBpZiAoYmFubmVyc0FycmF5ICYmIGJhbm5lcnNBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICBiYW5uZXJzQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoYmFubmVySXRlbSkge1xuICAgICAgICB2YXIgbGlzdEJhbm5lcnNJZCA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc3RvcmVJZCcpICYmIHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc3RvcmVJZCcpID09PSAnTF9aQVRUSU5JJyA/IGxpc3RCYW5uZXJzSWRaYXR0aW5pIDogbGlzdEJhbm5lcnNJZE5ldHNob2VzO1xuICAgICAgICB2YXIgYmFubmVySWQgPSBiYW5uZXJJdGVtLmlkLnJlcGxhY2UoLy0vZywgJ18nKTtcbiAgICAgICAgdmFyIGJhbm5lcnNDbHVzdGVySWRDb3VudCA9IGJhbm5lckl0ZW0uZGF0YS5pbWFnZXMgPyBiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzLmxlbmd0aCA6IDE7XG4gICAgICAgIHZhciBjdXJyZW50QmFubmVyQ291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKS5sZW5ndGggOiAwO1xuICAgICAgICBpZiAoYmFubmVySXRlbS5kYXRhLnR5cGUgPT09ICdIVE1MJykge1xuICAgICAgICAgIGNoYW5nZUJhbm5lcnNIdG1sKGxpc3RCYW5uZXJzSWQsIGJhbm5lcklkLCBiYW5uZXJJdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjaGFuZ2VCYW5uZXJzSW1hZ2UobGlzdEJhbm5lcnNJZCwgYmFubmVySWQsIGJhbm5lcnNDbHVzdGVySWRDb3VudCwgY3VycmVudEJhbm5lckNvdW50LCBiYW5uZXJJdGVtKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJlbW92ZVBsYWNlaG9sZGVyQmFubmVyKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0QmFubmVyc1xuICAgKi9cbiAgdmFyIGdldEJhbm5lcnMgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAoKFVTRVJfQ0xVU1RFUiAmJiAhVVNFUl9DTFVTVEVSLmluY2x1ZGVzKCdhbm9ueW1vdXMnKSkgfHwgKHR5cGVvZiBBRERSRVNTX1VGID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgQUREUkVTU19DSVRZID09PSAnc3RyaW5nJykpIHtcbiAgICAgIHZhciBjYW1wYWlnbiA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnY2FtcGFpZ25Db2RlJykgfHwgJyc7XG4gICAgICB2YXIgY2x1c3RlcklkID0gVVNFUl9DTFVTVEVSIHx8IG51bGw7XG4gICAgICB2YXIgdWYgPSBnZXRaaXBjb2RlSW5mb0VuYWJsZWQgPyAoQUREUkVTU19VRiB8fCBudWxsKSA6IG51bGw7XG4gICAgICB2YXIgY2l0eUNvZGUgPSBnZXRaaXBjb2RlSW5mb0VuYWJsZWQgPyAoQUREUkVTU19DSVRZIHx8IG51bGwpIDogbnVsbDtcblxuICAgICAgdmFyIHVybCA9ICcvYmFubmVyL3VzZXJjbHVzdGVyLycgKyBjbHVzdGVySWQgKyAnL3VmLycgKyB1ZiArICcvY2l0eS8nICsgY2l0eUNvZGUgKyAnLycgKyBjYW1wYWlnbjtcblxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgIHR5cGU6ICdqc29uJyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgIGNoYW5nZUJhbm5lcnMocmVzdWx0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgIHJlbW92ZVBsYWNlaG9sZGVyQmFubmVyKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QodXJsLCBvcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlUGxhY2Vob2xkZXJCYW5uZXIoKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIHJlaW5pdFZhcmlhYmxlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICBVU0VSX0NMVVNURVIgPSBkZWNvZGVVUklDb21wb25lbnQod2luZG93LmZyZWVkb20uZ2V0Q29va2llKCdjbHVzdGVySWQnKSkgfHwgdW5kZWZpbmVkO1xuICAgIFVVSUQgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3V1aWQnKSB8fCB1bmRlZmluZWQ7XG4gICAgU1RPUkVfSUQgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3NvdHJlSWQnKSB8fCB1bmRlZmluZWQ7XG4gICAgQUREUkVTU19VRiA9IHR5cGVvZiB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3VmJykgPT09ICdzdHJpbmcnID8gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCd1ZicpIDogdW5kZWZpbmVkO1xuICAgIEFERFJFU1NfQ0lUWSA9IHR5cGVvZiB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ2NpdHlDb2RlJykgPT09ICdzdHJpbmcnID8gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCdjaXR5Q29kZScpIDogdW5kZWZpbmVkO1xuICAgIFpJUENPREUgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3ppcGNvZGUnKSB8fCB1bmRlZmluZWQ7XG5cbiAgICBnZXRCYW5uZXJzKCk7XG4gIH07XG5cbiAgdmFyIHNldENvb2tpZXMgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICB2YXIgZGF0YSA9IHJlc3BvbnNlIHx8IHt9O1xuICAgIHZhciBjbHVzdGVySWQgPSBkYXRhLmNsdXN0ZXJzID8gY29uY2F0Q2x1c3RlcnNQcm9wKGRhdGEuY2x1c3RlcnMsICdpZCcpIDogJyc7XG4gICAgdmFyIG1haW5BZGRyZXNzID0gZ2V0TWFpbkFkZHJlc3MoZGF0YS5hZGRyZXNzZXMpO1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICBpZiAoY2x1c3RlcklkKSB7XG4gICAgICBzZXRDb29raWUoJ2NsdXN0ZXJJZCcsIGNsdXN0ZXJJZCwgZGF0ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldENvb2tpZSgnY2x1c3RlcklkJywgJ2Fub255bW91cycsIGRhdGUpO1xuICAgIH1cbiAgICBpZiAobWFpbkFkZHJlc3MpIHtcbiAgICAgIGlmIChtYWluQWRkcmVzcy56aXBDb2RlKSB7XG4gICAgICAgIHNldENvb2tpZSgnemlwY29kZScsIG1haW5BZGRyZXNzLnppcENvZGUsIGRhdGUpO1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2NoYW5nZUhlYWRlclppcGNvZGUnLCBtYWluQWRkcmVzcy56aXBDb2RlKTtcbiAgICAgIH1cbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignZ2V0WmlwY29kZUZ1bGxJbmZvJywgbWFpbkFkZHJlc3MuemlwQ29kZSwgdHJ1ZSk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcmVpbml0VmFyaWFibGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBnZXRMb2dnZWRVc2VyQW5kR2VuZXJhdGVDb29raWVzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKHNob3VsZExvYWRVc2VyKFVVSUQsIFVTRVJfQ0xVU1RFUiwgWklQQ09ERSkpIHtcbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICB0eXBlOiAnanNvbicsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICB1dWlkOiBVVUlELFxuICAgICAgICAgIHN0b3JlSWQ6IFNUT1JFX0lEXG4gICAgICAgIH0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICBzZXRDb29raWVzKHJlc3VsdCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICBnZXRCYW5uZXJzKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QoJy9zb2Z0LWxvZ2luP2NsdXN0ZXI9dHJ1ZScsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZ2V0WmlwY29kZUluZm9FbmFibGVkICYmICghQUREUkVTU19VRiB8fCAhQUREUkVTU19DSVRZKSAmJiBVU0VSX0NMVVNURVIgJiYgWklQQ09ERSkge1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2dldFppcGNvZGVGdWxsSW5mbycsIFpJUENPREUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2V0QmFubmVycygpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB0cnkge1xuICAgIGdldExvZ2dlZFVzZXJBbmRHZW5lcmF0ZUNvb2tpZXMoKTtcbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ2dldFNlZ21lbnRhdGlvbkJhbm5lcnMnLCByZWluaXRWYXJpYWJsZXMpO1xuICAgIGNvbnNvbGUubG9nKCc9PT09PT09PT1aSVAnKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB0cnlpbmcgdG8gZ2V0IGxvZ2dlZCB1c2VyIGluZm8gYW5kIGdlbmVyYXRlIGNvb2tpZXMnLCBlcnJvcik7XG4gIH1cblxufSgpKTtcbiJdfQ==
