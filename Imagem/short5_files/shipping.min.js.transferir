"use strict";var appShiping=function(){var e,t=document.querySelector("[data-shipping-date]"),i=document.querySelector("section[data-free-shipping-by-zipcode]"),n=document.querySelector("section[data-get-zipcode-info]"),o=!1,r=function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},a=function(){return document.querySelector("html").getAttribute("lang")},d=function(e){e?(document.querySelector(".ajax-loading-out").classList.remove("hide"),document.querySelector("[data-shipping-form]").classList.add("opacity")):(document.querySelector(".ajax-loading-out").classList.add("hide"),document.querySelector("[data-shipping-form]").classList.remove("opacity"))},s=function(e){var t=e.split(""),i=t.map(function(e,t){return 5===t?"-"+e:e});return i=i.join(""),i?i:null},u=function(e){var t=e.split("-"),i=[];t.forEach(function(e){var t=e.replace(/^0+(?!\.|$)/,"");i.push(t)}),i=i.join("/");var n=new Date(i),o={month:"long",day:"numeric"},r=a(),d=n.toLocaleDateString(r,o);return d?d:null},c=function(){var e=document.querySelector("[data-shipping-form]");window.freedom.nsPubSub.pub("fieldMask.load",e)},l=function(e,i){null!==r("zipcode")&&i?(document.querySelector("[data-shipping-button-consult]").classList.add(e),t.classList.add("available"),t.classList.remove(e),document.querySelector("[data-shipping-dates-table]").classList.remove(e)):document.querySelector("[data-shipping-button-consult]").classList.remove(e)},p=function(){document.querySelector("[data-shipping-container-input]").classList.add("hide"),t.classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector(".shipping__input-fail-err").classList.remove("hide"),document.querySelector("[data-shipping-button-consult]").classList.remove("hide"),d(!1)},m=function(e,t){if(""!==e){var i=e.replace(/\D/g,""),n=/^[0-9]{8}$/;return"es-AR"===t?n=/^[0-9]{4}$/:"es-MX"===t&&(n=/^[0-9]{5}$/),n.test(i)}return!1},h=function(){""!==document.querySelector("[data-shipping-input]").value?document.querySelector("[data-shipping-button-consult] label").classList.remove("hide"):document.querySelector("[data-shipping-button-consult] label").classList.add("hide")},g=function(e){if(document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]").length>0){var t=document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]");t.forEach(function(t){t.classList.add("hide");var i=t.getAttribute("data-seller-id");if(e[i]){var n=e[i][0].deliveryDate,o=u(n);document.querySelectorAll('.box-best-seller [data-seller-id="'+i+'"] .date').forEach(function(e){e&&(e.innerText=o,e.parentElement.classList.remove("hide"))})}})}},y=function(e,t,i,n){var o=e[0],r=o.minDeliveryDate,a=o.type,d=u(r);"SUPER_EXPRESS"===a?r===i?document.querySelector(".best-shipping-message").innerHTML="<b>Receba hoje</b> ao finalizar o pedido até às 12h com a opção de entrega Super Expressa para o CEP "+t+".":r===n?document.querySelector(".best-shipping-message").innerHTML="<b>Receba amanhã</b> ao escolher a opção de entrega Super Expressa para o CEP "+t+".":document.querySelector(".best-shipping-message").innerHTML="<b>Receba dia "+d+"</b> ao escolher a opção de entrega Super Expressa para o CEP "+t+".":"EXPRESS"===a?document.querySelector(".best-shipping-message").innerHTML="<b>Receba a partir do dia "+d+"</b> ao escolher a opção de entrega Expressa para o CEP "+t+".":"NORMAL"===a&&(document.querySelector(".best-shipping-message").innerHTML="<b>Receba a partir do dia "+d+"</b> ao escolher a opção de entrega Normal para o CEP "+t+".")},b=function(){var e=document.querySelector(".no-delivery-option .zipcode");e.innerHTML=r("zipcode"),t.classList.add("unavailable"),t.classList.remove("hide"),document.querySelector("[data-shipping-button-consult]").classList.add("hide")},S=function(e,n){if(null!==r("zipcode")&&null!==e){var o=Object.getOwnPropertyNames(e).length>0;if(o){g(e);var a=document.querySelector(".shipping__table");a.querySelector("tbody").innerHTML="",document.querySelector(".shipping__delivery-magalu")&&(document.querySelector(".shipping__delivery-magalu").classList.add("hide"),document.querySelector(".shipping__delivery-magalu span").innerHTML="");var d=document.querySelector(".shipping__input").getAttribute("data-sellerid"),c=e[d],m=new Date,h=m.toLocaleDateString("pt-BR").match(/(^\d{2})\/(\d{2})\/(\d{4})/);h=h.reduceRight(function(e,t,i){return i?1===i?e+t:e+t+"-":e},""),m.setDate(m.getDate()+1);var S=m.toLocaleDateString("pt-BR").match(/(^\d{2})\/(\d{2})\/(\d{4})/);S=S.reduceRight(function(e,t,i){return i?1===i?e+t:e+t+"-":e},""),c.forEach(function(e,t){var i=e.minDeliveryDate,n="",o=a.rows.length,r=a.insertRow(o),d=r.insertCell(0),s=r.insertCell(1),c=e.type,l="",p="";window.freedom.i18n.deliveryMsg[c]&&window.freedom.i18n.deliveryMsg[c].type&&window.freedom.i18n.deliveryMsg[c].text&&("SUPER_EXPRESS"===c?i===h?(l=window.freedom.i18n.deliveryMsg.SUPER_EXPRESS.type,p="Receba hoje"):i===S?(l=window.freedom.i18n.deliveryMsg.SUPER_EXPRESS.type,p="Receba amanhã"):(l=window.freedom.i18n.deliveryMsg.SUPER_EXPRESS.type,p="Receba dia ",n=u(i)):(l=window.freedom.i18n.deliveryMsg[c].type,p=window.freedom.i18n.deliveryMsg[c].text,n=u(i))),d.innerHTML=l,s.innerHTML=p+" "+n,"COLLECT_MAGALU"===c&&(document.querySelector(".shipping__delivery-magalu")?(document.querySelector(".shipping__delivery-magalu").classList.remove("hide"),document.querySelector(".shipping__delivery-magalu span").innerHTML=p+" "+n):a.deleteRow(t))});var f=r("zipcode"),v=s(f);document.querySelector(".shipping__zipcode-current").innerHTML=v,y(c,v,h,S),l("hide",!0)}else 0===Object.getOwnPropertyNames(e).length?"PDP_MANUAL"===n?b():(i||(document.cookie="zipcode="),t.classList.add("hide"),document.querySelector(".shipping__button--consult").classList.remove("hide")):(i||(document.cookie="zipcode="),p())}else i||(document.cookie="zipcode="),p(),console.log("ERROR | Shipping")},f=function(){var e=[];return document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]").length>0?(document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]").forEach(function(t){var i=t.getAttribute("data-seller-id");e.push(i)}),e=e.toString()):e=document.querySelector(".shipping__input[data-sellerid]").getAttribute("data-sellerid"),e},v=function(i,n){var r="PDP_AUTO"===i?"PDP_AUTO":"PDP_MANUAL",a=document.querySelector("[data-shipping-input]"),s=f();t=document.querySelector("[data-shipping-date]");var u=n,c=a.getAttribute("data-sku"),l=a.getAttribute("data-height"),m=a.getAttribute("data-weight"),h=a.getAttribute("data-depth"),g=a.getAttribute("data-width"),y=a.getAttribute("data-preSale")||!1,b=a.getAttribute("data-canbetransportedbyair")||!1;window.freedom.restClient.request("/refactoring/shipping",{displayLoading:!1,method:"get",data:{zipCode:u,sellerId:s,sku:c,height:l,weight:m,depth:h,width:g,preSale:y,canbetransportedbyair:b,hasPersona:o,additionalDeliveryDays:e,headerType:r},success:function(e){u&&"PDP_MANUAL"===r&&(window.freedom.nsPubSub.pub("checkFreeShippingEligibility",u,"PDP_ZIPCODE-FORM"),window.freedom.nsPubSub.pub("getZipcodeFullInfo",u),window.zipcodeAPIsAjax=!1,window.freedom.nsPubSub.pub("changeHeaderZipcode",u),window.freedom.nsPubSub.pub("zipcodeCookie.reinit")),204===e.status?p():S(e,r)},error:p,complete:function(){d(!1)}})},w=function(e){null!==r("zipcode")&&""!==r("zipcode")?(e&&d(!0),v("PDP_AUTO",r("zipcode")),document.querySelector("[data-shipping-input]").value=r("zipcode")):document.querySelector(".shipping__button--consult").classList.contains("hide")&&document.querySelector(".shipping__button--consult").classList.remove("hide")},L=function(t){o=t,e=t?document.querySelector("[data-shipping-input]").getAttribute("data-adddeliverydays"):0,w("show")},q=function(e){if(e)d(!1),""!==document.querySelector(".shipping__input-box>input[type=tel]").value?(document.querySelector("[data-shipping-container-input]").classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector(".shipping__input-err").classList.remove("hide"),document.querySelector(".shipping__input-empty").classList.add("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide")):(document.querySelector("[data-shipping-container-input]").classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector(".shipping__input-err").classList.add("hide"),document.querySelector(".shipping__input-empty").classList.remove("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide"));else{document.querySelector(".shipping__input-err").classList.add("hide"),document.querySelector(".shipping__input-empty").classList.add("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide"),i||n?window.freedom.nsPubSub.pub("nsLoading.show",document.body):d(!0);var t=document.querySelector("[data-shipping-input]").value.replace(/\D/g,"")||r("zipcode");v(null,t)}},_=!0,P=function(){_&&(_=!1,window.freedom.live("[data-shipping-input]","input",function(){h()}),window.freedom.live("[data-shipping-input]","blur",function(){h()}))},E=function(){window.freedom.live("[data-shipping-button-consult] button","click",function(e){e.preventDefault(),c()}),window.freedom.live("[data-shipping-button-change]","click",function(){c(),document.querySelector("[data-shipping-button-consult]").classList.remove("hide"),t.classList.add("hide"),t.classList.remove("unavailable"),t.classList.remove("available")}),window.freedom.live("[internal-data-shipping-button-change]","click",function(){document.querySelector("[data-shipping-container-input]").classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector("[data-shipping-button-consult]").classList.remove("hide"),t.classList.add("hide"),t.classList.remove("unavailable"),t.classList.remove("available"),c(),document.querySelector("[data-shipping-input]").focus()}),window.freedom.live("[data-shipping-close], #overlay","click",function(){window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector("[data-shipping-container-input]").classList.add("hide")}),window.freedom.live("[data-shipping-button-submit]","click",function(e){e.preventDefault();var t=document.querySelector("[data-shipping-input]").value,i=a();q(!m(t,i))}),document.querySelector("[data-shipping-button-open-form]")&&window.freedom.live("[data-shipping-button-open-form]","click",function(e){e.preventDefault(),window.freedom.nsPubSub.pub("overlay.display","show"),document.querySelector("[data-shipping-container-input]").classList.remove("hide")}),window.freedom.live("[data-shipping-input]","click",function(){document.querySelector(".shipping__input-err").classList.add("hide"),document.querySelector(".shipping__input-empty").classList.add("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide"),P()})};try{E(),c(),window.freedom.nsPubSub.sub("Shipping.restart",w),window.freedom.nsPubSub.sub("update.hasPersona.state",L)}catch(R){console.error("ERROR | Shipping "+R)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9wcm9kdWN0L3NoaXBwaW5nL2Rlc2t0b3Avc2hpcHBpbmcubWluLmpzIl0sIm5hbWVzIjpbImFwcFNoaXBpbmciLCJhZGRpdGlvbmFsRGVsaXZlcnlEYXlzIiwiQkxPQ0tfU0hJUFBJTkdfREFURSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNoZWNrRnJlZVNoaXBwaW5nRW5hYmxlZCIsImdldFppcGNvZGVJbmZvRW5hYmxlZCIsImhhc1BlcnNvbmEiLCJnZXRDb29raWUiLCJja25hbWUiLCJ6aXBjb2RlIiwiY29va2llIiwibWF0Y2giLCJnZXRDb3VudHJ5IiwiZ2V0QXR0cmlidXRlIiwiYWpheExvYWRpbmciLCJzaG93IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiZm9ybWF0WmlwY29kZSIsInoiLCJzcGxpdCIsImZvcm1hdHRlZFppcGNvZGUiLCJtYXAiLCJlbGVtIiwiaW5kZXgiLCJqb2luIiwiZm9ybWF0RGF0ZSIsImRhdGUiLCJkIiwibnVtZXJpY0RhdGUiLCJmb3JFYWNoIiwiaSIsIml0ZW0iLCJyZXBsYWNlIiwicHVzaCIsInN0cmluZ0RhdGUiLCJEYXRlIiwib3B0aW9ucyIsIm1vbnRoIiwiZGF5IiwiY291bnRyeSIsIm5ld0RhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJhcHBseUlucHV0TWFrcyIsImZvcm0iLCJ3aW5kb3ciLCJmcmVlZG9tIiwibnNQdWJTdWIiLCJwdWIiLCJoaWRlT3JTaG93RWxlbXMiLCJjbGFzc05hbWUiLCJtb2RhbCIsInNoaXBwaW5nRXJyb3IiLCJ2YWxpZGF0ZVppcGNvZGUiLCJjIiwicmVnZXgiLCJ0ZXN0IiwiaGlkZU9yU2hvd0xhYmVsIiwidmFsdWUiLCJhcHBlbmRlWmlwY29kZUJlc3RTZWxsZXJzIiwiZGF0YSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJsZW5ndGgiLCIkYWxsU2VsbGVycyIsIiRlbCIsInNlbGxlcklkIiwiZGVsaXZlcnlEYXRlIiwiZGF0ZUZvcm1hdHRlZCIsIiR0aGlzIiwiaW5uZXJUZXh0IiwicGFyZW50RWxlbWVudCIsImNoZWNrQmVzdFRpbWVJbkRheXMiLCJyZXMiLCJjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSIsInRvZGF5IiwidG9tb3Jyb3ciLCJmYXN0ZXN0RGVsaXZlcnkiLCJmYXN0ZXN0RGVsaXZlcnlEYXRlIiwibWluRGVsaXZlcnlEYXRlIiwiZmFzdGVzdERlbGl2ZXJ5VHlwZSIsInR5cGUiLCJmb3JtYXRlZERhdGUiLCJpbm5lckhUTUwiLCJkZWxpdmVyeVVuYXZhaWxhYmxlIiwiemlwY29kZVRhZyIsImFwcGVuZGVycyIsInJlcVR5cGUiLCJzaGlwcGluZ05vdEVtcHR5IiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsInRhYmxlIiwic2VsbGVySWRDdXJyZW50IiwiYXJyRGVsaXZlcnlEYXRlIiwiY3VycmVudERhdGUiLCJyZWR1Y2VSaWdodCIsImFjYyIsImVsIiwic2V0RGF0ZSIsImdldERhdGUiLCJ0b21vcnJvd0RhdGUiLCJrZXkiLCJyb3dDb3VudCIsInJvd3MiLCJyb3ciLCJpbnNlcnRSb3ciLCJjb2wxIiwiaW5zZXJ0Q2VsbCIsImNvbDIiLCJkZWxpdmVyeVR5cGUiLCJ0ZXh0VHlwZSIsInRleHQiLCJpMThuIiwiZGVsaXZlcnlNc2ciLCJkZWxldGVSb3ciLCJjdXJyZW50WmlwY29kZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRTZWxsZXJzSWRzIiwiYXJyc2VsbGVySWQiLCJzZWxsZXIiLCJ0b1N0cmluZyIsInN1Ym1pdFNoaXBwaW5nUmVxdWVzdCIsImhlYWRlclR5cGUiLCJ6aXBDb2RlIiwic2t1IiwiaGVpZ2h0Iiwid2VpZ2h0IiwiZGVwdGgiLCJ3aWR0aCIsInByZVNhbGUiLCJjYW5iZXRyYW5zcG9ydGVkYnlhaXIiLCJyZXN0Q2xpZW50IiwicmVxdWVzdCIsImRpc3BsYXlMb2FkaW5nIiwibWV0aG9kIiwic3VjY2VzcyIsInppcGNvZGVBUElzQWpheCIsInN0YXR1cyIsImVycm9yIiwiY29tcGxldGUiLCJ2YWxpZGF0ZUNvb2tpZSIsImNvbnRhaW5zIiwidXBkYXRlSGFzUGVyc29uYVN0YXRlIiwic3RhdGUiLCJ2YWxpZGF0aW9uQ2FsbGJhY2siLCJib2R5IiwibmV3WmlwY29kZSIsImF1eFNldEZvY3VzIiwib25mb2N1cyIsImxpdmUiLCJzZXRMaXN0ZW5lcnMiLCJlIiwicHJldmVudERlZmF1bHQiLCJmb2N1cyIsInN1YiIsImVyciJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFJQSxZQUFjLFdBRWhCLEdBSUVDLEdBSkVDLEVBQXNCQyxTQUFTQyxjQUFjLHdCQUMvQ0MsRUFBMkJGLFNBQVNDLGNBQWMsMENBQ2xERSxFQUF3QkgsU0FBU0MsY0FBYyxrQ0FDL0NHLEdBQWEsRUFRWEMsRUFBWSxTQUFVQyxHQUN4QixHQUFJQyxHQUFVUCxTQUFTUSxPQUFPQyxNQUFNLFVBQVlILEVBQVMsZ0JBQ3pELE9BQU9DLEdBQVVBLEVBQVEsR0FBSyxNQVE1QkcsRUFBYSxXQUNmLE1BQU9WLFVBQVNDLGNBQWMsUUFBUVUsYUFBYSxTQVFqREMsRUFBYyxTQUFVQyxHQUN0QkEsR0FDRmIsU0FBU0MsY0FBYyxxQkFBcUJhLFVBQVVDLE9BQU8sUUFDN0RmLFNBQVNDLGNBQWMsd0JBQXdCYSxVQUFVRSxJQUFJLGFBRTdEaEIsU0FBU0MsY0FBYyxxQkFBcUJhLFVBQVVFLElBQUksUUFDMURoQixTQUFTQyxjQUFjLHdCQUF3QmEsVUFBVUMsT0FBTyxhQVVoRUUsRUFBZ0IsU0FBVUMsR0FDNUIsR0FBSVgsR0FBVVcsRUFBRUMsTUFBTSxJQUVsQkMsRUFBbUJiLEVBQVFjLElBQUksU0FBVUMsRUFBTUMsR0FDakQsTUFBYyxLQUFWQSxFQUNLLElBQU1ELEVBRU5BLEdBS1gsT0FGQUYsR0FBbUJBLEVBQWlCSSxLQUFLLElBRWhDSixFQUFtQkEsRUFBbUIsTUFTN0NLLEVBQWEsU0FBVUMsR0FDekIsR0FBSUMsR0FBSUQsRUFBS1AsTUFBTSxLQUNmUyxJQUdKRCxHQUFFRSxRQUFRLFNBQVVDLEdBQ2xCLEdBQUlDLEdB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Q3BEcEosU0FBU0MsY0FBYyx3QkFBd0JhLFVBQVVFLElBQUksUUFDN0RoQixTQUFTQyxjQUFjLDBCQUEwQmEsVUFBVUUsSUFBSSxRQUMvRGhCLFNBQVNDLGNBQWMsNkJBQTZCYSxVQUFVRSxJQUFJLFFBQ2xFbUksTUFLSixLQUNFRSxJQUNBM0csSUFDQUUsT0FBT0MsUUFBUUMsU0FBUzJHLElBQUksbUJBQW9CZCxHQUNoRC9GLE9BQU9DLFFBQVFDLFNBQVMyRyxJQUFJLDBCQUEyQlosR0FFdkQsTUFBT2EsR0FDUHhDLFFBQVF1QixNQUFNLG9CQUFzQmlCIiwiZmlsZSI6Il9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9wcm9kdWN0L3NoaXBwaW5nL2Rlc2t0b3Avc2hpcHBpbmcubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwU2hpcGluZyA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIEJMT0NLX1NISVBQSU5HX0RBVEUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1kYXRlXScpLFxuICAgIGNoZWNrRnJlZVNoaXBwaW5nRW5hYmxlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb25bZGF0YS1mcmVlLXNoaXBwaW5nLWJ5LXppcGNvZGVdJyksXG4gICAgZ2V0WmlwY29kZUluZm9FbmFibGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2VjdGlvbltkYXRhLWdldC16aXBjb2RlLWluZm9dJyksXG4gICAgaGFzUGVyc29uYSA9IGZhbHNlLFxuICAgIGFkZGl0aW9uYWxEZWxpdmVyeURheXM7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0Q29va2llXG4gICAqIEdldCBjb29raWUgYnkgbmFtZVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFt6aXBjb2RlXVxuICAgKi9cbiAgdmFyIGdldENvb2tpZSA9IGZ1bmN0aW9uIChja25hbWUpIHtcbiAgICB2YXIgemlwY29kZSA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgnKF58OykgPycgKyBja25hbWUgKyAnPShbXjtdKikoO3wkKScpO1xuICAgIHJldHVybiB6aXBjb2RlID8gemlwY29kZVsyXSA6IG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0Q291bnRyeVxuICAgKiBHZXQgY291bnRyeVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFtjb3VudHJ5XVxuICAgKi9cbiAgdmFyIGdldENvdW50cnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKS5nZXRBdHRyaWJ1dGUoJ2xhbmcnKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhamF4TG9hZGluZ1xuICAgKiBBdXggZm9yIGhpZGUvc2hvdyBsb2FkaW5nIGdpZlxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYWpheExvYWRpbmcgPSBmdW5jdGlvbiAoc2hvdykge1xuICAgIGlmIChzaG93KSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWpheC1sb2FkaW5nLW91dCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWZvcm1dJykuY2xhc3NMaXN0LmFkZCgnb3BhY2l0eScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWpheC1sb2FkaW5nLW91dCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWZvcm1dJykuY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eScpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBmb3JtYXRaaXBjb2RlXG4gICAqIEZvcm1hdCB6aXBjb2RlIHdpdGggXCItXCIgbGlrZSB0aGlzIDAwMDAwLTAwMFxuICAgKiBAcGFyYW0gIHtzdHJpbmd9IHogW3VzZXIncyB6aXBjb2RlXVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFtmb3JtYXR0ZWQgemlwY29kZV1cbiAgICovXG4gIHZhciBmb3JtYXRaaXBjb2RlID0gZnVuY3Rpb24gKHopIHtcbiAgICB2YXIgemlwY29kZSA9IHouc3BsaXQoJycpO1xuXG4gICAgdmFyIGZvcm1hdHRlZFppcGNvZGUgPSB6aXBjb2RlLm1hcChmdW5jdGlvbiAoZWxlbSwgaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCA9PT0gNSkge1xuICAgICAgICByZXR1cm4gJy0nICsgZWxlbTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBlbGVtO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGZvcm1hdHRlZFppcGNvZGUgPSBmb3JtYXR0ZWRaaXBjb2RlLmpvaW4oJycpO1xuXG4gICAgcmV0dXJuICEhZm9ybWF0dGVkWmlwY29kZSA/IGZvcm1hdHRlZFppcGNvZGUgOiBudWxsO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGZvcm1hdERhdGVcbiAgICogRm9ybWF0IGRhdGUgYW5kIHJldHVybiBhdCBmb3JtYXQgdGV4dFxuICAgKiBAcGFyYW0gIHtkYXRlfSBkYXRlIFtkZWxpdmVyeSBkYXRlXVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFt0ZXh0IGRlbGl2ZXJ5IGRhdGVdXG4gICAqL1xuICB2YXIgZm9ybWF0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgdmFyIGQgPSBkYXRlLnNwbGl0KCctJyk7XG4gICAgdmFyIG51bWVyaWNEYXRlID0gW107XG5cbiAgICAvLyByZW1vdmUgbGVmdCB6ZXJvXG4gICAgZC5mb3JFYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICB2YXIgaXRlbSA9IGkucmVwbGFjZSgvXjArKD8hXFwufCQpLywgJycpO1xuICAgICAgbnVtZXJpY0RhdGUucHVzaChpdGVtKTtcbiAgICB9KTtcbiAgICBudW1lcmljRGF0ZSA9IG51bWVyaWNEYXRlLmpvaW4oJy8nKTtcblxuICAgIC8vIHRyYW5zZm9ybSBudW1lcmljIGRhdGUgaW4gc3RyaW5nXG4gICAgdmFyIHN0cmluZ0RhdGUgPSBuZXcgRGF0ZShudW1lcmljRGF0ZSk7XG4gICAgdmFyIG9wdGlvbnMgPSB7IG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH07XG5cbiAgICAvLyBjb3VudHJ5XG4gICAgdmFyIGNvdW50cnkgPSBnZXRDb3VudHJ5KCk7XG5cbiAgICAvLyBzZXQgZGF0ZVxuICAgIHZhciBuZXdEYXRlID0gc3RyaW5nRGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoY291bnRyeSwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gISFuZXdEYXRlID8gbmV3RGF0ZSA6IG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXBwbHlJbnB1dE1ha3NcbiAgICogQXBwbHkgemlwY29kZSBtYXNrIDAwMDAwLTAwMFxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYXBwbHlJbnB1dE1ha3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1mb3JtXScpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignZmllbGRNYXNrLmxvYWQnLCBmb3JtKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBoaWRlT3JTaG93RWxlbXNcbiAgICogQXV4IGZvciBoaWRlL3Nob3cgZWxlbWVudHMgYWZ0ZXIgY2FsY3VsYXRlIHNoaXBwaW5nXG4gICAqIEBwYXJhbSAge3N0cmluZ30gY2xhc3NOYW1lIFtoaWRlOiB0byBoaWRlIGVsZW1lbnRzfHNob3c6IHRvIHNob3cgZWxlbWVudHNdXG4gICAqIEBwYXJhbSAge2Jvb2xlYW59IG1vZGFsIFtlbGVtZW50IGh0bWxdXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBoaWRlT3JTaG93RWxlbXMgPSBmdW5jdGlvbiAoY2xhc3NOYW1lLCBtb2RhbCkge1xuICAgIGlmIChnZXRDb29raWUoJ3ppcGNvZGUnKSAhPT0gbnVsbCAmJiBtb2RhbCkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdJykuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdhdmFpbGFibGUnKTtcbiAgICAgIEJMT0NLX1NISVBQSU5HX0RBVEUuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctZGF0ZXMtdGFibGVdJykuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1idXR0b24tY29uc3VsdF0nKS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHNoaXBwaW5nRXJyb3JcbiAgICogQVBJIGVycm9yXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBzaGlwcGluZ0Vycm9yID0gZnVuY3Rpb24gKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWNvbnRhaW5lci1pbnB1dF0nKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnaGlkZScpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZmFpbC1lcnInKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIGFqYXhMb2FkaW5nKGZhbHNlKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCB2YWxpZGF0ZVppcGNvZGVcbiAgICogVGVzdCB0byB2YWxpZGF0ZSBpZiB0aGUgaW5wdXQgemlwY29kZSBpcyB2YWxpZCBhY2NvcmRpbmcgdG8gdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzXG4gICAqIEBwYXJhbSAge3N0cmluZ30geiBbemlwY29kZV1cbiAgICogQHBhcmFtICB7c3RyaW5nfSBjIFtjb3VudHJ5XVxuICAgKiBAcmV0dXJuIHtib29sZWFufSBbdHJ1ZSBvciBmYWxzZV1cbiAgICovXG4gIHZhciB2YWxpZGF0ZVppcGNvZGUgPSBmdW5jdGlvbiAoeiwgYykge1xuICAgIGlmICh6ICE9PSAnJykge1xuICAgICAgLy8gcmVtb3ZlcyBhbnkgY2hhcmFjdGVyIHRoYXQgaXMgbm90IGEgZGlnaXQgY2hhcmFjdGVyICgwLTkpXG4gICAgICB2YXIgemlwY29kZSA9IHoucmVwbGFjZSgvXFxEL2csICcnKTtcblxuICAgICAgLy8gOCBkaWdpdHMgMCB0byA5XG4gICAgICB2YXIgcmVnZXggPSAvXlswLTldezh9JC87XG5cbiAgICAgIC8vIDQgZGlnaXRzIDAgdG8gOVxuICAgICAgaWYgKGMgPT09ICdlcy1BUicpIHtcbiAgICAgICAgcmVnZXggPSAvXlswLTldezR9JC87XG5cbiAgICAgICAgLy8gNSBkaWdpdHMgMCB0byA5XG4gICAgICB9IGVsc2UgaWYgKGMgPT09ICdlcy1NWCcpIHtcbiAgICAgICAgcmVnZXggPSAvXlswLTldezV9JC87XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZWdleC50ZXN0KHppcGNvZGUpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgaGlkZU9yU2hvd0xhYmVsXG4gICAqIGF1eCBmb3IgaGlkZS9zaG93IGxhYmVsIG9mIGlucHV0XG4gICAqIEByZXR1cm4ge31cbiAgICovXG5cbiAgdmFyIGhpZGVPclNob3dMYWJlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykudmFsdWUgIT09ICcnKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1idXR0b24tY29uc3VsdF0gbGFiZWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XSBsYWJlbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXBwZW5kZVppcGNvZGVCZXN0U2VsbGVyc1xuICAgKiBBcHBlbmRlIGRlbGl2ZXJ5IGRhdGUgZm9yIGJlc3Qgc2VsbGVyc1xuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYXBwZW5kZVppcGNvZGVCZXN0U2VsbGVycyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib3gtYmVzdC1zZWxsZXIgPiAuc2VsbGVyLW1vZGFsLXRpbmdsZSBbZGF0YS1zZWxsZXItaWRdJykubGVuZ3RoID4gMCkge1xuICAgICAgdmFyICRhbGxTZWxsZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJveC1iZXN0LXNlbGxlciA+IC5zZWxsZXItbW9kYWwtdGluZ2xlIFtkYXRhLXNlbGxlci1pZF0nKTtcblxuICAgICAgJGFsbFNlbGxlcnMuZm9yRWFjaChmdW5jdGlvbiAoJGVsKSB7XG5cbiAgICAgICAgJGVsLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcblxuICAgICAgICB2YXIgc2VsbGVySWQgPSAkZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGxlci1pZCcpO1xuICAgICAgICBpZiAoZGF0YVtzZWxsZXJJZF0pIHtcblxuICAgICAgICAgIC8vIEZvcm1hdCBkYXRlIGFuZCBhcHBlbmRcbiAgICAgICAgICB2YXIgZGF0ZSA9IGRhdGFbc2VsbGVySWRdWzBdLmRlbGl2ZXJ5RGF0ZTtcbiAgICAgICAgICB2YXIgZGF0ZUZvcm1hdHRlZCA9IGZvcm1hdERhdGUoZGF0ZSk7XG5cbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm94LWJlc3Qtc2VsbGVyIFtkYXRhLXNlbGxlci1pZD1cIicgKyBzZWxsZXJJZCArICdcIl0gLmRhdGUnKS5mb3JFYWNoKGZ1bmN0aW9uICgkdGhpcykge1xuICAgICAgICAgICAgaWYgKCR0aGlzKSB7XG4gICAgICAgICAgICAgICR0aGlzLmlubmVyVGV4dCA9IGRhdGVGb3JtYXR0ZWQ7XG4gICAgICAgICAgICAgICR0aGlzLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2hlY2tCZXN0VGltZUluRGF5c1xuICAgKiBhcHBlbmQgbWVzc2FnZVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgY2hlY2tCZXN0VGltZUluRGF5cyA9IGZ1bmN0aW9uIChyZXMsIGN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlLCB0b2RheSwgdG9tb3Jyb3cpIHtcbiAgICB2YXIgZmFzdGVzdERlbGl2ZXJ5ID0gcmVzWzBdO1xuICAgIHZhciBmYXN0ZXN0RGVsaXZlcnlEYXRlID0gZmFzdGVzdERlbGl2ZXJ5Lm1pbkRlbGl2ZXJ5RGF0ZTtcbiAgICB2YXIgZmFzdGVzdERlbGl2ZXJ5VHlwZSA9IGZhc3Rlc3REZWxpdmVyeS50eXBlO1xuXG4gICAgdmFyIGZvcm1hdGVkRGF0ZSA9IGZvcm1hdERhdGUoZmFzdGVzdERlbGl2ZXJ5RGF0ZSk7XG5cbiAgICAvL0NoZWNrIHRoZSBtZXNzYWdlIHRvIHNob3cgdG8gdGhlIGNsaWVudFxuICAgIGlmIChmYXN0ZXN0RGVsaXZlcnlUeXBlID09PSBcIlNVUEVSX0VYUFJFU1NcIikge1xuICAgICAgaWYgKGZhc3Rlc3REZWxpdmVyeURhdGUgPT09IHRvZGF5KSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZXN0LXNoaXBwaW5nLW1lc3NhZ2UnKS5pbm5lckhUTUwgPSAnPGI+UmVjZWJhIGhvamU8L2I+IGFvIGZpbmFsaXphciBvIHBlZGlkbyBhdMOpIMOgcyAxMmggY29tIGEgb3DDp8OjbyBkZSBlbnRyZWdhIFN1cGVyIEV4cHJlc3NhIHBhcmEgbyBDRVAgJyArXG4gICAgICAgICAgY3VycmVudEZvcm1hdHRlZFppcGNvZGUgKyAnLic7XG4gICAgICB9IGVsc2UgaWYgKGZhc3Rlc3REZWxpdmVyeURhdGUgPT09IHRvbW9ycm93KSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZXN0LXNoaXBwaW5nLW1lc3NhZ2UnKS5pbm5lckhUTUwgPSAnPGI+UmVjZWJhIGFtYW5ow6M8L2I+IGFvIGVzY29saGVyIGEgb3DDp8OjbyBkZSBlbnRyZWdhIFN1cGVyIEV4cHJlc3NhIHBhcmEgbyBDRVAgJyArXG4gICAgICAgICAgY3VycmVudEZvcm1hdHRlZFppcGNvZGUgKyAnLic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVzdC1zaGlwcGluZy1tZXNzYWdlJykuaW5uZXJIVE1MID0gJzxiPlJlY2ViYSBkaWEgJyArIGZvcm1hdGVkRGF0ZSArICc8L2I+IGFvIGVzY29saGVyIGEgb3DDp8OjbyBkZSBlbnRyZWdhIFN1cGVyIEV4cHJlc3NhIHBhcmEgbyBDRVAgJyArXG4gICAgICAgICAgY3VycmVudEZvcm1hdHRlZFppcGNvZGUgKyAnLic7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChmYXN0ZXN0RGVsaXZlcnlUeXBlID09PSBcIkVYUFJFU1NcIikge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJlc3Qtc2hpcHBpbmctbWVzc2FnZScpLmlubmVySFRNTCA9ICc8Yj5SZWNlYmEgYSBwYXJ0aXIgZG8gZGlhICcgKyBmb3JtYXRlZERhdGUgKyAnPC9iPiBhbyBlc2NvbGhlciBhIG9ww6fDo28gZGUgZW50cmVnYSBFeHByZXNzYSBwYXJhIG8gQ0VQICcgK1xuICAgICAgICBjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSArICcuJztcbiAgICB9IGVsc2UgaWYgKGZhc3Rlc3REZWxpdmVyeVR5cGUgPT09IFwiTk9STUFMXCIpIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZXN0LXNoaXBwaW5nLW1lc3NhZ2UnKS5pbm5lckhUTUwgPSAnPGI+UmVjZWJhIGEgcGFydGlyIGRvIGRpYSAnICsgZm9ybWF0ZWREYXRlICsgJzwvYj4gYW8gZXNjb2xoZXIgYSBvcMOnw6NvIGRlIGVudHJlZ2EgTm9ybWFsIHBhcmEgbyBDRVAgJyArXG4gICAgICAgIGN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlICsgJy4nO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBkZWxpdmVyeVVuYXZhaWxhYmxlXG4gICAqIGFwcGVuZCBkZWxpdmVyeSBkYXRlXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBkZWxpdmVyeVVuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB6aXBjb2RlVGFnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vLWRlbGl2ZXJ5LW9wdGlvbiAuemlwY29kZScpO1xuICAgIHppcGNvZGVUYWcuaW5uZXJIVE1MID0gZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCd1bmF2YWlsYWJsZScpO1xuICAgIEJMT0NLX1NISVBQSU5HX0RBVEUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhcHBlbmRlcnNcbiAgICogYXBwZW5kIGRlbGl2ZXJ5IGRhdGVcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIGFwcGVuZGVycyA9IGZ1bmN0aW9uIChyZXMsIHJlcVR5cGUpIHtcbiAgICBpZiAoZ2V0Q29va2llKCd6aXBjb2RlJykgIT09IG51bGwgJiYgcmVzICE9PSBudWxsKSB7XG5cbiAgICAgIHZhciBzaGlwcGluZ05vdEVtcHR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocmVzKS5sZW5ndGggPiAwO1xuXG4gICAgICBpZiAoc2hpcHBpbmdOb3RFbXB0eSkge1xuICAgICAgICAvLyBBcHBlbmQgZGVsaXZlcnkgZm9yIGFsbCBzZWxsZXJzXG4gICAgICAgIGFwcGVuZGVaaXBjb2RlQmVzdFNlbGxlcnMocmVzKTtcblxuICAgICAgICAvLyBVcGRhdGUgdGFibGUgb2YgbWFpbiBzZWxsZXJcbiAgICAgICAgdmFyIHRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX190YWJsZScpO1xuICAgICAgICB0YWJsZS5xdWVyeVNlbGVjdG9yKCd0Ym9keScpLmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgIC8vVXBkYXRlIGluZm8gRGVsaXZlcnkgTWFnYWx1XG4gICAgICAgIGlmKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fZGVsaXZlcnktbWFnYWx1JykpIHtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2RlbGl2ZXJ5LW1hZ2FsdScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2RlbGl2ZXJ5LW1hZ2FsdSBzcGFuJykuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2VsbGVySWRDdXJyZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dCcpLmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxsZXJpZCcpO1xuICAgICAgICB2YXIgYXJyRGVsaXZlcnlEYXRlID0gcmVzW3NlbGxlcklkQ3VycmVudF07XG5cbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB2YXIgY3VycmVudERhdGUgPSBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygncHQtQlInKS5tYXRjaCgvKF5cXGR7Mn0pXFwvKFxcZHsyfSlcXC8oXFxkezR9KS8pO1xuICAgICAgICBjdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlLnJlZHVjZVJpZ2h0KGZ1bmN0aW9uIChhY2MsIGVsLCBpbmRleCkge1xuICAgICAgICAgIGlmICghaW5kZXgpIHJldHVybiBhY2M7XG4gICAgICAgICAgaWYgKGluZGV4ID09PSAxKSByZXR1cm4gYWNjICsgZWw7XG4gICAgICAgICAgcmV0dXJuIGFjYyArIGVsICsgJy0nO1xuICAgICAgICB9LCAnJyk7XG5cbiAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgMSk7XG4gICAgICAgIHZhciB0b21vcnJvd0RhdGUgPSBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygncHQtQlInKS5tYXRjaCgvKF5cXGR7Mn0pXFwvKFxcZHsyfSlcXC8oXFxkezR9KS8pO1xuICAgICAgICB0b21vcnJvd0RhdGUgPSB0b21vcnJvd0RhdGUucmVkdWNlUmlnaHQoZnVuY3Rpb24gKGFjYywgZWwsIGluZGV4KSB7XG4gICAgICAgICAgaWYgKCFpbmRleCkgcmV0dXJuIGFjYztcbiAgICAgICAgICBpZiAoaW5kZXggPT09IDEpIHJldHVybiBhY2MgKyBlbDtcbiAgICAgICAgICByZXR1cm4gYWNjICsgZWwgKyAnLSc7XG4gICAgICAgIH0sICcnKTtcblxuICAgICAgICBhcnJEZWxpdmVyeURhdGUuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwga2V5KSB7XG4gICAgICAgICAgLy8gRm9ybWF0IGRhdGVcbiAgICAgICAgICB2YXIgZGVsaXZlcnlEYXRlID0gaXRlbS5taW5EZWxpdmVyeURhdGU7XG4gICAgICAgICAgLy8gdmFyIGRhdGVGb3JtYXR0ZWQgPSBmb3JtYXREYXRlKGRlbGl2ZXJ5RGF0ZSk7XG4gICAgICAgICAgdmFyIGRhdGVGb3JtYXR0ZWQgPSBcIlwiO1xuXG4gICAgICAgICAgLy8gVGV4dCBvZiBkZWxpdmVyeSB0eXBlXG4gICAgICAgICAgdmFyIHJvd0NvdW50ID0gdGFibGUucm93cy5sZW5ndGg7XG4gICAgICAgICAgdmFyIHJvdyA9IHRhYmxlLmluc2VydFJvdyhyb3dDb3VudCk7XG4gICAgICAgICAgdmFyIGNvbDEgPSByb3cuaW5zZXJ0Q2VsbCgwKTtcbiAgICAgICAgICB2YXIgY29sMiA9IHJvdy5pbnNlcnRDZWxsKDEpO1xuICAgICAgICAgIHZhciBkZWxpdmVyeVR5cGUgPSBpdGVtLnR5cGU7XG4gICAgICAgICAgdmFyIHRleHRUeXBlID0gJyc7XG4gICAgICAgICAgdmFyIHRleHQgPSAnJztcblxuICAgICAgICAgIGlmICh3aW5kb3cuZnJlZWRvbS5pMThuLmRlbGl2ZXJ5TXNnW2RlbGl2ZXJ5VHlwZV0gJiZcbiAgICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLmkxOG4uZGVsaXZlcnlNc2dbZGVsaXZlcnlUeXBlXS50eXBlICYmXG4gICAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5pMThuLmRlbGl2ZXJ5TXNnW2RlbGl2ZXJ5VHlwZV0udGV4dFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaWYgKGRlbGl2ZXJ5VHlwZSA9PT0gXCJTVVBFUl9FWFBSRVNTXCIpIHtcbiAgICAgICAgICAgICAgaWYgKGRlbGl2ZXJ5RGF0ZSA9PT0gY3VycmVudERhdGUpIHtcbiAgICAgICAgICAgICAgICB0ZXh0VHlwZSA9IHdpbmRvdy5mcmVlZG9tLmkxOG4uZGVsaXZlcnlNc2dbXCJTVVBFUl9FWFBSRVNTXCJdLnR5cGU7XG4gICAgICAgICAgICAgICAgdGV4dCA9IFwiUmVjZWJhIGhvamVcIjtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZWxpdmVyeURhdGUgPT09IHRvbW9ycm93RGF0ZSkge1xuICAgICAgICAgICAgICAgIHRleHRUeXBlID0gd2luZG93LmZyZWVkb20uaTE4bi5kZWxpdmVyeU1zZ1tcIlNVUEVSX0VYUFJFU1NcIl0udHlwZTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gXCJSZWNlYmEgYW1hbmjDo1wiO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRleHRUeXBlID0gd2luZG93LmZyZWVkb20uaTE4bi5kZWxpdmVyeU1zZ1tcIlNVUEVSX0VYUFJFU1NcIl0udHlwZTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gJ1JlY2ViYSBkaWEgJztcbiAgICAgICAgICAgICAgICBkYXRlRm9ybWF0dGVkID0gZm9ybWF0RGF0ZShkZWxpdmVyeURhdGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0ZXh0VHlwZSA9IHdpbmRvdy5mcmVlZG9tLmkxOG4uZGVsaXZlcnlNc2dbZGVsaXZlcnlUeXBlXS50eXBlO1xuICAgICAgICAgICAgICB0ZXh0ID0gd2luZG93LmZyZWVkb20uaTE4bi5kZWxpdmVyeU1zZ1tkZWxpdmVyeVR5cGVdLnRleHQ7XG4gICAgICAgICAgICAgIGRhdGVGb3JtYXR0ZWQgPSBmb3JtYXREYXRlKGRlbGl2ZXJ5RGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29sMS5pbm5lckhUTUwgPSB0ZXh0VHlwZTtcbiAgICAgICAgICBjb2wyLmlubmVySFRNTCA9IHRleHQgKyAnICcgKyBkYXRlRm9ybWF0dGVkO1xuXG4gICAgICAgICAgaWYoZGVsaXZlcnlUeXBlID09PSBcIkNPTExFQ1RfTUFHQUxVXCIpIHtcbiAgICAgICAgICAgIGlmKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fZGVsaXZlcnktbWFnYWx1JykpIHtcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19kZWxpdmVyeS1tYWdhbHUnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fZGVsaXZlcnktbWFnYWx1IHNwYW4nKS5pbm5lckhUTUwgPSB0ZXh0ICsgJyAnICsgZGF0ZUZvcm1hdHRlZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhYmxlLmRlbGV0ZVJvdyhrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9ybWF0IHppcGNvZGVcbiAgICAgICAgdmFyIGN1cnJlbnRaaXBjb2RlID0gZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgICAgIHZhciBjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSA9IGZvcm1hdFppcGNvZGUoY3VycmVudFppcGNvZGUpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX3ppcGNvZGUtY3VycmVudCcpLmlubmVySFRNTCA9IGN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlO1xuXG4gICAgICAgIGNoZWNrQmVzdFRpbWVJbkRheXMoYXJyRGVsaXZlcnlEYXRlLCBjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSwgY3VycmVudERhdGUsIHRvbW9ycm93RGF0ZSk7XG4gICAgICAgIGhpZGVPclNob3dFbGVtcygnaGlkZScsIHRydWUpO1xuICAgICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhyZXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBpZiAocmVxVHlwZSA9PT0gJ1BEUF9NQU5VQUwnKSB7XG4gICAgICAgICAgZGVsaXZlcnlVbmF2YWlsYWJsZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghY2hlY2tGcmVlU2hpcHBpbmdFbmFibGVkKSBkb2N1bWVudC5jb29raWUgPSBcInppcGNvZGU9XCI7XG4gICAgICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19idXR0b24tLWNvbnN1bHQnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghY2hlY2tGcmVlU2hpcHBpbmdFbmFibGVkKSBkb2N1bWVudC5jb29raWUgPSBcInppcGNvZGU9XCI7XG4gICAgICAgIHNoaXBwaW5nRXJyb3IoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFjaGVja0ZyZWVTaGlwcGluZ0VuYWJsZWQpIGRvY3VtZW50LmNvb2tpZSA9IFwiemlwY29kZT1cIjtcbiAgICAgIHNoaXBwaW5nRXJyb3IoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiB8IFNoaXBwaW5nJyk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdldFNlbGxlcnNJZHNcbiAgICpcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIGdldFNlbGxlcnNJZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFycnNlbGxlcklkID0gW107XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib3gtYmVzdC1zZWxsZXIgPiAuc2VsbGVyLW1vZGFsLXRpbmdsZSBbZGF0YS1zZWxsZXItaWRdJykubGVuZ3RoID4gMCkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJveC1iZXN0LXNlbGxlciA+IC5zZWxsZXItbW9kYWwtdGluZ2xlIFtkYXRhLXNlbGxlci1pZF0nKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciBzZWxsZXIgPSBpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxsZXItaWQnKTtcbiAgICAgICAgYXJyc2VsbGVySWQucHVzaChzZWxsZXIpO1xuICAgICAgfSk7XG4gICAgICBhcnJzZWxsZXJJZCA9IGFycnNlbGxlcklkLnRvU3RyaW5nKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFycnNlbGxlcklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dFtkYXRhLXNlbGxlcmlkXScpLmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxsZXJpZCcpO1xuICAgIH1cblxuICAgIHJldHVybiBhcnJzZWxsZXJJZDtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBzdWJtaXRTaGlwcGluZ1JlcXVlc3RcbiAgICogcmVxdWVzdCBmb3IgZ2V0IGRlbGl2ZXJ5IGRhdGVcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIHN1Ym1pdFNoaXBwaW5nUmVxdWVzdCA9IGZ1bmN0aW9uICh0eXBlLCB6aXBjb2RlKSB7XG4gICAgdmFyIGhlYWRlclR5cGUgPSB0eXBlID09PSAnUERQX0FVVE8nID8gJ1BEUF9BVVRPJyA6ICdQRFBfTUFOVUFMJztcbiAgICB2YXIgJGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJyk7XG4gICAgdmFyIHNlbGxlcklkID0gZ2V0U2VsbGVyc0lkcygpO1xuICAgIEJMT0NLX1NISVBQSU5HX0RBVEUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1kYXRlXScpO1xuXG4gICAgdmFyIHppcENvZGUgPSB6aXBjb2RlLFxuICAgICAgc2t1ID0gJGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1za3UnKSxcbiAgICAgIGhlaWdodCA9ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JyksXG4gICAgICB3ZWlnaHQgPSAkZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXdlaWdodCcpLFxuICAgICAgZGVwdGggPSAkZWwuZ2V0QXR0cmlidXRlKCdkYXRhLWRlcHRoJyksXG4gICAgICB3aWR0aCA9ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2lkdGgnKSxcbiAgICAgIHByZVNhbGUgPSAkZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXByZVNhbGUnKSB8fCBmYWxzZSxcbiAgICAgIGNhbmJldHJhbnNwb3J0ZWRieWFpciA9ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2FuYmV0cmFuc3BvcnRlZGJ5YWlyJykgfHwgZmFsc2U7XG5cbiAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QoJy9yZWZhY3RvcmluZy9zaGlwcGluZycsIHtcbiAgICAgIGRpc3BsYXlMb2FkaW5nOiBmYWxzZSxcbiAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHppcENvZGU6IHppcENvZGUsXG4gICAgICAgIHNlbGxlcklkOiBzZWxsZXJJZCxcbiAgICAgICAgc2t1OiBza3UsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICB3ZWlnaHQ6IHdlaWdodCxcbiAgICAgICAgZGVwdGg6IGRlcHRoLFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIHByZVNhbGU6IHByZVNhbGUsXG4gICAgICAgIGNhbmJldHJhbnNwb3J0ZWRieWFpcjogY2FuYmV0cmFuc3BvcnRlZGJ5YWlyLFxuICAgICAgICBoYXNQZXJzb25hOiBoYXNQZXJzb25hLFxuICAgICAgICBhZGRpdGlvbmFsRGVsaXZlcnlEYXlzOiBhZGRpdGlvbmFsRGVsaXZlcnlEYXlzLFxuICAgICAgICBoZWFkZXJUeXBlOiBoZWFkZXJUeXBlXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICBpZiAoemlwQ29kZSAmJiBoZWFkZXJUeXBlID09PSAnUERQX01BTlVBTCcpIHtcbiAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2NoZWNrRnJlZVNoaXBwaW5nRWxpZ2liaWxpdHknLCB6aXBDb2RlLCAnUERQX1pJUENPREUtRk9STScpO1xuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignZ2V0WmlwY29kZUZ1bGxJbmZvJywgemlwQ29kZSk7XG4gICAgICAgICAgd2luZG93LnppcGNvZGVBUElzQWpheCA9IGZhbHNlO1xuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY2hhbmdlSGVhZGVyWmlwY29kZScsIHppcENvZGUpO1xuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignemlwY29kZUNvb2tpZS5yZWluaXQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjA0KSB7XG4gICAgICAgICAgc2hpcHBpbmdFcnJvcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFwcGVuZGVycyhyZXMsIGhlYWRlclR5cGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IHNoaXBwaW5nRXJyb3IsXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBhamF4TG9hZGluZyhmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCB2YWxpZGF0ZUNvb2tpZVxuICAgKiB2YWxpZGF0ZSBjb29raWUgdG8gc3RhcnQgdGhlIHJlcXVlc3RcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIHZhbGlkYXRlQ29va2llID0gZnVuY3Rpb24gKHNob3cpIHtcbiAgICBpZiAoZ2V0Q29va2llKCd6aXBjb2RlJykgIT09IG51bGwgJiYgZ2V0Q29va2llKCd6aXBjb2RlJykgIT09ICcnKSB7XG4gICAgICBpZiAoc2hvdykgYWpheExvYWRpbmcodHJ1ZSk7XG4gICAgICBzdWJtaXRTaGlwcGluZ1JlcXVlc3QoJ1BEUF9BVVRPJywgZ2V0Q29va2llKCd6aXBjb2RlJykpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykudmFsdWUgPSBnZXRDb29raWUoJ3ppcGNvZGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fYnV0dG9uLS1jb25zdWx0JykuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRlJykpIHtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19idXR0b24tLWNvbnN1bHQnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAqIEBtZXRob2QgdXBkYXRlSGFzUGVyc29uYVN0YXRlXG4gICogYXBwZW5kIG1lc3NhZ2VcbiAgKiBAcmV0dXJuIHt9XG4gICovXG4gIHZhciB1cGRhdGVIYXNQZXJzb25hU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICBoYXNQZXJzb25hID0gc3RhdGU7XG4gICAgaWYgKHN0YXRlKSB7XG4gICAgICBhZGRpdGlvbmFsRGVsaXZlcnlEYXlzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykuZ2V0QXR0cmlidXRlKCdkYXRhLWFkZGRlbGl2ZXJ5ZGF5cycpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhZGRpdGlvbmFsRGVsaXZlcnlEYXlzID0gMDtcbiAgICB9XG4gICAgdmFsaWRhdGVDb29raWUoJ3Nob3cnKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCB2YWxpZGF0aW9uQ2FsbGJhY2tcbiAgICogY2hlY2sgZm9yIGZpZWxkIGVycm9yXG4gICAqIEBwYXJhbSAge2Jvb2xlYW59IGVycm9yXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciB2YWxpZGF0aW9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGFqYXhMb2FkaW5nKGZhbHNlKTtcbiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWJveD5pbnB1dFt0eXBlPXRlbF0nKS52YWx1ZSAhPT0gXCJcIikge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1jb250YWluZXItaW5wdXRdJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ292ZXJsYXkuZGlzcGxheScsICdoaWRlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZXJyJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWVtcHR5JykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWZhaWwtZXJyJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctY29udGFpbmVyLWlucHV0XScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnaGlkZScpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWVycicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1lbXB0eScpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1mYWlsLWVycicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1lcnInKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWVtcHR5JykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1mYWlsLWVycicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcblxuICAgICAgaWYgKGNoZWNrRnJlZVNoaXBwaW5nRW5hYmxlZCB8fCBnZXRaaXBjb2RlSW5mb0VuYWJsZWQpIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCduc0xvYWRpbmcuc2hvdycsIGRvY3VtZW50LmJvZHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWpheExvYWRpbmcodHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBuZXdaaXBjb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykudmFsdWUucmVwbGFjZSgvXFxEL2csICcnKSB8fCBnZXRDb29raWUoJ3ppcGNvZGUnKTtcbiAgICAgIHN1Ym1pdFNoaXBwaW5nUmVxdWVzdChudWxsLCBuZXdaaXBjb2RlKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgb25mb2N1c1xuICAgKiBhZGQgZXZlbnQgdG8gaW5wdXQgZm9jdXNcbiAgICogW2F1eFNldEZvY3VzXSBhdXggZm9yIG5vdCB0byBkdXBsaWNhdGUgZXZlbnRzXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBhdXhTZXRGb2N1cyA9IHRydWU7XG4gIHZhciBvbmZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChhdXhTZXRGb2N1cykge1xuICAgICAgYXV4U2V0Rm9jdXMgPSBmYWxzZTtcblxuICAgICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2RhdGEtc2hpcHBpbmctaW5wdXRdJywgJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBoaWRlT3JTaG93TGFiZWwoKTtcbiAgICAgIH0pO1xuICAgICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2RhdGEtc2hpcHBpbmctaW5wdXRdJywgJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhpZGVPclNob3dMYWJlbCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHNldExpc3RlbmVyc1xuICAgKiBldmVudHMgY2xpY2tcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIHNldExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBCdXR0b24gY29uc3VsdCBmcmVpZ3RoXG4gICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdIGJ1dHRvbicsICdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBhcHBseUlucHV0TWFrcygpO1xuICAgIH0pO1xuXG4gICAgLy8gQnV0dG9uIGNoYW5nZSBmcmVpZ3RoXG4gICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNoYW5nZV0nLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBhcHBseUlucHV0TWFrcygpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBCTE9DS19TSElQUElOR19EQVRFLmNsYXNzTGlzdC5yZW1vdmUoJ3VuYXZhaWxhYmxlJyk7XG4gICAgICBCTE9DS19TSElQUElOR19EQVRFLmNsYXNzTGlzdC5yZW1vdmUoJ2F2YWlsYWJsZScpO1xuICAgIH0pO1xuXG4gICAgLy8gQnV0dG9uIGNoYW5nZSBmcmVpZ3RoIGludGVybmFsXG4gICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2ludGVybmFsLWRhdGEtc2hpcHBpbmctYnV0dG9uLWNoYW5nZV0nLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1jb250YWluZXItaW5wdXRdJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnaGlkZScpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBCTE9DS19TSElQUElOR19EQVRFLmNsYXNzTGlzdC5yZW1vdmUoJ3VuYXZhaWxhYmxlJyk7XG4gICAgICBCTE9DS19TSElQUElOR19EQVRFLmNsYXNzTGlzdC5yZW1vdmUoJ2F2YWlsYWJsZScpO1xuXG4gICAgICBhcHBseUlucHV0TWFrcygpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykuZm9jdXMoKTtcbiAgICB9KTtcblxuICAgIC8vIENsb3NlIChidXR0b24gb3Igb3ZlcmxheSlcbiAgICB3aW5kb3cuZnJlZWRvbS5saXZlKCdbZGF0YS1zaGlwcGluZy1jbG9zZV0sICNvdmVybGF5JywgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnaGlkZScpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctY29udGFpbmVyLWlucHV0XScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB9KTtcblxuICAgIC8vIFN1Ym1pdFxuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1zdWJtaXRdJywgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHZhciB6aXBjb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykudmFsdWU7XG4gICAgICB2YXIgY291bnRyeSA9IGdldENvdW50cnkoKTtcblxuICAgICAgdmFsaWRhdGVaaXBjb2RlKHppcGNvZGUsIGNvdW50cnkpID8gdmFsaWRhdGlvbkNhbGxiYWNrKGZhbHNlKSA6IHZhbGlkYXRpb25DYWxsYmFjayh0cnVlKTtcbiAgICB9KTtcblxuICAgIC8vZGF0YS1zaGlwcGluZy1idXR0b24tb3Blbi1mb3JtXG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1vcGVuLWZvcm1dJykpIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1vcGVuLWZvcm1dJywgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ292ZXJsYXkuZGlzcGxheScsICdzaG93Jyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWNvbnRhaW5lci1pbnB1dF0nKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDYWxsIHRvIGV2ZW50IGZvY3VzXG4gICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2RhdGEtc2hpcHBpbmctaW5wdXRdJywgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1lcnInKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWVtcHR5JykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1mYWlsLWVycicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIG9uZm9jdXMoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBJbml0aWFsaXplIGFwcGxpY2F0aW9uXG4gIHRyeSB7XG4gICAgc2V0TGlzdGVuZXJzKCk7XG4gICAgYXBwbHlJbnB1dE1ha3MoKTtcbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ1NoaXBwaW5nLnJlc3RhcnQnLCB2YWxpZGF0ZUNvb2tpZSk7XG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCd1cGRhdGUuaGFzUGVyc29uYS5zdGF0ZScsIHVwZGF0ZUhhc1BlcnNvbmFTdGF0ZSk7XG5cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcignRVJST1IgfCBTaGlwcGluZyAnICsgZXJyKTtcbiAgfVxufSgpKTtcbiJdfQ==
