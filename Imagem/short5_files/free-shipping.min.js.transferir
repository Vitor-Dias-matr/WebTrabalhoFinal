"use strict";!function(e,i){function n(){s=window.freedom.getCookie("zipcode")}var r=dataLayer&&dataLayer.length&&dataLayer[0].page?dataLayer[0].page.pageID.toLowerCase():"others",o=i.cookie.includes("zipcode"),t=i.cookie.includes("fshipEligible"),s=window.freedom.getCookie("zipcode"),d=window.freedom.getCookie("fshipEligible"),c=document.querySelector("section[data-get-zipcode-info]"),u=function(){c?window.zipcodeAPIsAjax?window.freedom.nsPubSub.pub("nsLoading.hide",document.body):window.zipcodeAPIsAjax=!0:window.freedom.nsPubSub.pub("nsLoading.hide",document.body)},a=function(){d=window.freedom.getCookie("fshipEligible")},l=function(e,i){if(e.freeShipping&&!i.querySelector(".tag-shipping")){var n=document.createElement("p");n.classList.add("tag-shipping"),n.classList.add("new-tag"),n.innerHTML="FRETE GRÁTIS",i.insertAdjacentElement("afterbegin",n)}else e.freeShipping&&i.querySelector(".tag-shipping")?i.querySelector(".tag-shipping").classList.remove("hide"):!e.freeShipping&&i.querySelector(".tag-shipping")&&i.querySelector(".tag-shipping").classList.add("hide")},p=function(e){e.querySelector(".tag-shipping.new-tag")&&e.querySelector(".tag-shipping.new-tag").classList.add("hide"),e.querySelector(".tag-shipping:not(.new-tag)")&&e.querySelector(".tag-shipping:not(.new-tag)").classList.remove("hide")},g=function(e,i,n,r){var o=i.querySelector(".freeDelivery-container");if(!o)return void window.freedom.nsPubSub.pub("returnCheckedFreeShipping",n,i);if(e.freeShipping){if(i.querySelector(".freeDelivery-gif")&&i.querySelector(".freeDelivery-gif").classList.add("hide"),i.querySelector(".freeDelivery-icon")&&i.querySelector(".freeDelivery-icon").classList.add("hide"),o.querySelector(".tag-shipping"))o.querySelector(".tag-shipping").classList.remove("hide"),o.querySelector(".ns-icon-free-shipping").classList.remove("hide");else{var t=document.createElement("p");t.classList.add("tag-shipping"),t.classList.add("new-tag"),t.innerHTML="FRETE GRÁTIS";var s=document.createElement("i");s.classList.add("ns-icon"),s.classList.add("ns-icon-free-shipping"),o&&(o.appendChild(s),o.appendChild(t))}o.classList.remove("hide")}else e.freeShipping||o.children.length&&[].map.call(o.children,function(e){e.classList.add("hide")});n?(window.freedom.nsPubSub.pub("nsLoading.hide",document.body),window.freedom.nsPubSub.pub("returnCheckedFreeShipping",n,i,r)):u()},h=function(e,i,n){var r=e.querySelector(".freeDelivery-container");r&&(e.querySelector(".tag-shipping")&&(e.querySelector(".tag-shipping").classList.add("hide"),e.querySelector(".ns-icon-free-shipping").classList.add("hide")),e.querySelector(".freeDelivery-gif")&&e.querySelector(".freeDelivery-gif").classList.remove("hide"),e.querySelector(".freeDelivery-icon")&&e.querySelector(".freeDelivery-icon").classList.remove("hide"),r.classList.remove("hide")),i?(window.freedom.nsPubSub.pub("nsLoading.hide",document.body),window.freedom.nsPubSub.pub("returnCheckedFreeShipping",i,e,n)):u()},f=function(e,i){var n=i.querySelector(".freeDelivery-container");if(!n)return void window.freedom.nsPubSub.pub("returnCheckedFreeShippingQuickView",i);if(e.freeShipping){i.querySelector(".freeDelivery-icon")&&i.querySelector(".freeDelivery-icon").classList.add("hide");var r=document.createElement("p");r.classList.add("tag-shipping"),r.innerHTML="FRETE GRÁTIS";var o=document.createElement("i");o.classList.add("ns-icon"),o.classList.add("ns-icon-free-shipping"),n&&(n.appendChild(o),n.appendChild(r)),n.classList.remove("hide")}else e.freeShipping||n.children.length&&[].map.call(n.children,function(e){e.classList.add("hide")});window.freedom.nsPubSub.pub("returnCheckedFreeShippingQuickView",i)},w=function(e){var i=e.querySelector(".freeDelivery-container");i&&(e.querySelector(".tag-shipping")&&(e.querySelector(".tag-shipping").classList.add("hide"),e.querySelector(".ns-icon-free-shipping").classList.add("hide")),i.firstChildElement&&e.querySelector(".freeDelivery-icon")&&e.querySelector(".freeDelivery-icon").classList.remove("hide"),i.classList.remove("hide")),window.freedom.nsPubSub.pub("returnCheckedFreeShippingQuickView",e)},b=function(e,i,n,r,o,t){var s=document.querySelector("html").classList.contains("product-page")?"product":"search",d={method:"GET",headers:{storeId:window.freedom.getCookie("storeId"),campaign:window.freedom.getCookie("campaignCode")||""},success:function(e){"product"!==s&&!document.querySelector(".tingle-modal--visible")||r.classList.contains("is-quickview")?"search"!==s||r.classList.contains("is-quickview")?r.classList.contains("is-quickview")&&f(e,r):l(e,r):g(e,r,o,t)},error:function(){"product"===s||document.querySelector(".tingle-modal--visible")?h(r,o,t):"search"!==s||r.classList.contains("is-quickview")||document.querySelector(".tingle-modal--visible")?r.classList.contains("is-quickview")&&w(r):p(r)}},c="/promotion/shipping/"+e+"/sellers/"+i+"/zipCodes/"+n;e&&i&&n?window.freedom.restClient.request(c,d):"product"===s||document.querySelector(".tingle-modal--visible")?h(r,o,t):"search"!==s||r.classList.contains("is-quickview")||document.querySelector(".tingle-modal--visible")?r.classList.contains("is-quickview")&&w(r):p(r)},S=function(e){var i=e&&e.hasOwnProperty("eligible")?e.eligible:"";document.cookie="fshipEligible="+i+";max-age=7200;path=/",window.freedom.nsPubSub.pub("shippingEligibleCookie.reinit"),"search"===r?window.freedom.nsPubSub.pub("returnShippingEligibility.LazyPrice",i):"product"===r?window.freedom.nsPubSub.pub("returnShippingEligibility.PDP"):u()},m=function(e){var i=e||window.freedom.getCookie("zipcode");if(!i)return void S(null);var n={method:"GET",headers:{storeId:window.freedom.getCookie("storeId")},success:function(e){var i=e;"string"==typeof e&&(i=JSON.parse(e)),S(i)},error:function(){S(null)}},r="/promo/freeshipping/"+i+"/eligibility";window.freedom.restClient.request(r,n)},y=function(e){var i=e&&e.length&&e.hasOwnProperty("addresses")?e.addresses[0].zipCode:"",n=new Date;n.setMonth(n.getMonth()+1);var r="expires="+n.toUTCString();document.cookie="zipcode="+i+";"+r+";path=/",window.freedom.nsPubSub.pub("zipcodeCookie.reinit"),i&&(window.freedom.nsPubSub.pub("Shipping.restart"),window.freedom.nsPubSub.pub("changeHeaderZipcode",i)),window.freedom.nsPubSub.pub("checkFreeShippingEligibility",i)},v=function(){var e={method:"get",type:"json",success:function(e){e&&y(e)},error:function(){y()}};window.freedom.restClient.request("/soft-login",e)};window.freedom.nsPubSub.sub("zipcodeCookie.reinit",n),window.freedom.nsPubSub.sub("shippingEligibleCookie.reinit",a),window.freedom.nsPubSub.sub("verifyFreeShipping",b),window.freedom.nsPubSub.sub("checkFreeShippingEligibility",m),o&&!d&&m(s),t||o||v()}(window,window.document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9fYmVoYXZpb3IvZnJlZS1zaGlwcGluZy9hbGwvZnJlZS1zaGlwcGluZy5taW4uanMiXSwibmFtZXMiOlsid2luIiwiZG9jIiwicmVpbml0WmlwY29kZUNvb2tpZSIsImNvb2tpZVppcGNvZGUiLCJ3aW5kb3ciLCJmcmVlZG9tIiwiZ2V0Q29va2llIiwicGFnZVR5cGUiLCJkYXRhTGF5ZXIiLCJsZW5ndGgiLCJwYWdlIiwicGFnZUlEIiwidG9Mb3dlckNhc2UiLCJoYXNaaXBDb2RlQ29va2llIiwiY29va2llIiwiaW5jbHVkZXMiLCJoYXNFbGlnaWJsZUNvb2tpZSIsImNvb2tpZVNoaXBwaW5nRWxpZ2libGUiLCJnZXRaaXBjb2RlSW5mb0VuYWJsZWQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ1cGRhdGVMb2FkaW5nU3RhdGUiLCJ6aXBjb2RlQVBJc0FqYXgiLCJuc1B1YlN1YiIsInB1YiIsImJvZHkiLCJyZWluaXRDb29raWVTaGlwcGluZ0VsaWdpYmxlIiwic3VjY2Vzc1NlYXJjaCIsImRhdGEiLCJwcmljZSIsImZyZWVTaGlwcGluZyIsImVsIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImlubmVySFRNTCIsImluc2VydEFkamFjZW50RWxlbWVudCIsInJlbW92ZSIsImVycm9yU2VhcmNoIiwic3VjY2Vzc1Byb2R1Y3QiLCJjb250ZW50IiwicHJvcCIsImVsZW1lbnQiLCJmcmVlU2hpcHBpbmdDb250YWluZXIiLCJ0YWciLCJpY29uIiwiYXBwZW5kQ2hpbGQiLCJjaGlsZHJlbiIsIm1hcCIsImNhbGwiLCJlbGUiLCJlcnJvclByb2R1Y3QiLCJzdWNjZXNzUXVpY2tWaWV3IiwiZXJyb3JRdWlja1ZpZXciLCJmaXJzdENoaWxkRWxlbWVudCIsInZlcmlmeUZyZWVTaGlwcGluZyIsInNrdSIsInNlbGxlciIsInppcGNvZGUiLCJibG9jayIsImNvbnRhaW5zIiwib3B0aW9ucyIsIm1ldGhvZCIsImhlYWRlcnMiLCJzdG9yZUlkIiwiY2FtcGFpZ24iLCJzdWNjZXNzIiwicmVzIiwiZXJyb3IiLCJ1cmwiLCJyZXN0Q2xpZW50IiwicmVxdWVzdCIsInNldEVsaWdpYmlsaXR5Q29va2llIiwiZWxpZ2libGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNoZWNrRWxpZ2liaWxpdHkiLCJyZXNwIiwiSlNPTiIsInBhcnNlIiwic2V0WmlwQ29kZSIsImFkZHJlc3NlcyIsInppcENvZGUiLCJkYXRlIiwiRGF0ZSIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJleHBpcmVzIiwidG9VVENTdHJpbmciLCJjaGVja1NvZnRMb2dpbiIsInR5cGUiLCJyZXNwb25zZSIsInN1YiJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQyxTQUFVQSxFQUFLQyxHQWtDZCxRQUFTQyxLQUNQQyxFQUFnQkMsT0FBT0MsUUFBUUMsVUFBVSxXQWpDM0MsR0FBSUMsR0FBV0MsV0FBYUEsVUFBVUMsUUFBV0QsVUFBVSxHQUFPLEtBQUlBLFVBQVUsR0FBR0UsS0FBS0MsT0FBT0MsY0FBZ0IsU0FDN0dDLEVBQW1CWixFQUFJYSxPQUFPQyxTQUFTLFdBQ3ZDQyxFQUFvQmYsRUFBSWEsT0FBT0MsU0FBUyxpQkFDeENaLEVBQWdCQyxPQUFPQyxRQUFRQyxVQUFVLFdBQ3pDVyxFQUF5QmIsT0FBT0MsUUFBUUMsVUFBVSxpQkFJaERZLEVBQXdCQyxTQUFTQyxjQUFjLGtDQU8vQ0MsRUFBcUIsV0FDbkJILEVBQ0VkLE9BQU9rQixnQkFDVGxCLE9BQU9DLFFBQVFrQixTQUFTQyxJQUFJLGlCQUFrQkwsU0FBU00sTUFFdkRyQixPQUFPa0IsaUJBQWtCLEVBRzNCbEIsT0FBT0MsUUFBUWtCLFNBQVNDLElBQUksaUJBQWtCTCxTQUFTTSxPQWtCdkRDLEVBQStCLFdBQ2pDVCxFQUF5QmIsT0FBT0MsUUFBUUMsVUFBVSxrQkFRaERxQixFQUFnQixTQUFVQyxFQUFNQyxHQUNsQyxHQUFJRCxFQUFLRSxlQUFpQkQsRUFBTVQsY0FBYyxpQkFBa0IsQ0FDOUQsR0FB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QXdCekYsR0FDcERFLE9BQU9DLFFBQVFrQixTQUFTb0UsSUFBSSxnQ0FBaUNqRSxHQUc3RHRCLE9BQU9DLFFBQVFrQixTQUFTb0UsSUFBSSxxQkFBc0JwQyxHQUNsRG5ELE9BQU9DLFFBQVFrQixTQUFTb0UsSUFBSSwrQkFBZ0NoQixHQUV4RDlELElBQXFCSSxHQUN2QjBELEVBQWlCeEUsR0FFZGEsR0FBc0JILEdBQ3pCMkUsS0FHRnBGLE9BQVFBLE9BQU9lIiwiZmlsZSI6Il9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9fYmVoYXZpb3IvZnJlZS1zaGlwcGluZy9hbGwvZnJlZS1zaGlwcGluZy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAod2luLCBkb2MpIHtcblxuICB2YXIgcGFnZVR5cGUgPSBkYXRhTGF5ZXIgJiYgZGF0YUxheWVyLmxlbmd0aCAmJiAoZGF0YUxheWVyWzBdLnBhZ2UpID8gZGF0YUxheWVyWzBdLnBhZ2UucGFnZUlELnRvTG93ZXJDYXNlKCkgOiAnb3RoZXJzJyxcbiAgICBoYXNaaXBDb2RlQ29va2llID0gZG9jLmNvb2tpZS5pbmNsdWRlcygnemlwY29kZScpLFxuICAgIGhhc0VsaWdpYmxlQ29va2llID0gZG9jLmNvb2tpZS5pbmNsdWRlcygnZnNoaXBFbGlnaWJsZScpLFxuICAgIGNvb2tpZVppcGNvZGUgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3ppcGNvZGUnKSxcbiAgICBjb29raWVTaGlwcGluZ0VsaWdpYmxlID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCdmc2hpcEVsaWdpYmxlJyk7XG5cbiAgLy8gdGhpcyB2YXIgY2hlY2sgaWYgW2dldC16aXBjb2RlLWluZm9dIG9yIFtmcmVlLXNoaXBwaW5nXSBpcyBlbmFibGVkLCBiZWNhdXNlIHRoZSBbaW5zZXJ0LXppcC1jb2RlXSBpbnRlcmFjdCB3aXRoIGJvdGggQVBJc1xuICAvLyBpdCB3YXMgbmVlZCB0d28gc3luYyB0aGUgbnNMb2FkaW5nIHN0YXRlIG9uIHRoZSBjYWxsYmFjayBmdW5jIG9mIGJvdGggZmVhdHVyZXMgXG4gIHZhciBnZXRaaXBjb2RlSW5mb0VuYWJsZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzZWN0aW9uW2RhdGEtZ2V0LXppcGNvZGUtaW5mb10nKTtcblxuICAvKipcbiAgICogQG1ldGhvZCB1cGRhdGVMb2FkaW5nU3RhdGVcbiAgICogRnVuY3Rpb24gdG8gc3luYyB0aGUgbnNMb2FkaW5nIHN0YXRlIG9uIHRoZSBjYWxsYmFjayBmdW5jIG9mIHdoZW4gY2hhbmdlIHRoZSB6aXBjb2RlIG9uIFtpbnNlcnQtemlwLWNvZGVdXG4gICAqIFtmcmVlLXNoaXBwaW5nXSBhbmQgW2dldC16aXBjb2RlLWluZm9dIHJlc3BvbmRzIG9uIHppcGNvZGUgY29va2llIGNoYW5nZXNcbiAgICovXG4gIHZhciB1cGRhdGVMb2FkaW5nU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdldFppcGNvZGVJbmZvRW5hYmxlZCkge1xuICAgICAgaWYgKHdpbmRvdy56aXBjb2RlQVBJc0FqYXgpIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCduc0xvYWRpbmcuaGlkZScsIGRvY3VtZW50LmJvZHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LnppcGNvZGVBUElzQWpheCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbnNMb2FkaW5nLmhpZGUnLCBkb2N1bWVudC5ib2R5KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcmVpbml0WmlwY29kZUNvb2tpZSBjaGFuZ2VDb2xvciBjaGFuZ2VGbGF2b3JcbiAgICogRWFjaCBmdW5jdGlvbnMgd2F0Y2ggcmVzcGVjdGl2ZSBjaGFuZ2VzIG9mIGNvbG9yLCBmbGF2b3IgYW5kIHNpemVcbiAgICogQHBhcmFtICB7fVxuICAgKi9cbiAgZnVuY3Rpb24gcmVpbml0WmlwY29kZUNvb2tpZSgpIHtcbiAgICBjb29raWVaaXBjb2RlID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCByZWluaXRDb29raWVTaGlwcGluZ0VsaWdpYmxlXG4gICAqIEdldCBjb29raWUgYnkgbmFtZVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFt6aXBjb2RlXVxuICAgKi9cbiAgdmFyIHJlaW5pdENvb2tpZVNoaXBwaW5nRWxpZ2libGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29va2llU2hpcHBpbmdFbGlnaWJsZSA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnZnNoaXBFbGlnaWJsZScpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHN1Y2Nlc3NTZWFyY2hcbiAgICogUmV0dXJuIGEgcHJpY2UgY29udGVudCBpbiBzZWFyY2ggcGFnZXMgd2hlbiBGUkVFU0hJUFBJTkcgQVBJIHJldHVybnMgc3VjY2Vzc1xuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgc3VjY2Vzc1NlYXJjaCA9IGZ1bmN0aW9uIChkYXRhLCBwcmljZSkge1xuICAgIGlmIChkYXRhLmZyZWVTaGlwcGluZyAmJiAhcHJpY2UucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZycpKSB7XG4gICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKCd0YWctc2hpcHBpbmcnKTtcbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ25ldy10YWcnKTtcbiAgICAgIGVsLmlubmVySFRNTCA9IFwiRlJFVEUgR1LDgVRJU1wiO1xuICAgICAgcHJpY2UuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgZWwpO1xuICAgIH0gZWxzZSBpZiAoZGF0YS5mcmVlU2hpcHBpbmcgJiYgcHJpY2UucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZycpKSB7XG4gICAgICBwcmljZS5xdWVyeVNlbGVjdG9yKCcudGFnLXNoaXBwaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIH0gZWxzZSBpZiAoIWRhdGEuZnJlZVNoaXBwaW5nICYmIHByaWNlLnF1ZXJ5U2VsZWN0b3IoJy50YWctc2hpcHBpbmcnKSkge1xuICAgICAgcHJpY2UucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZycpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZXJyb3JTZWFyY2hcbiAgICogUmV0dXJuIGEgcHJpY2UgY29udGVudCBpbiBzZWFyY2ggcGFnZXMgd2hlbiBGUkVFU0hJUFBJTkcgQVBJIHJldHVybnMgc3VjY2Vzc1xuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgZXJyb3JTZWFyY2ggPSBmdW5jdGlvbiAocHJpY2UpIHtcbiAgICBpZiAocHJpY2UucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZy5uZXctdGFnJykpIHByaWNlLnF1ZXJ5U2VsZWN0b3IoJy50YWctc2hpcHBpbmcubmV3LXRhZycpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICBpZiAocHJpY2UucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZzpub3QoLm5ldy10YWcpJykpIHByaWNlLnF1ZXJ5U2VsZWN0b3IoJy50YWctc2hpcHBpbmc6bm90KC5uZXctdGFnKScpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBzdWNjZXNzUHJvZHVjdFxuICAgKiBSZXR1cm4gYSBmdWxsIGNvbnRlbnQgaW4gUHJvZHVjdCBwYWdlcyB3aGVuIEZSRUVTSElQUElORyBBUEkgcmV0dXJucyBzdWNjZXNzXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBzdWNjZXNzUHJvZHVjdCA9IGZ1bmN0aW9uIChkYXRhLCBjb250ZW50LCBwcm9wLCBlbGVtZW50KSB7XG5cbiAgICB2YXIgZnJlZVNoaXBwaW5nQ29udGFpbmVyID0gY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpO1xuICAgIGlmICghZnJlZVNoaXBwaW5nQ29udGFpbmVyKSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVybkNoZWNrZWRGcmVlU2hpcHBpbmcnLCBwcm9wLCBjb250ZW50KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5mcmVlU2hpcHBpbmcpIHtcbiAgICAgIGlmIChjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktZ2lmJykpIGNvbnRlbnQucXVlcnlTZWxlY3RvcignLmZyZWVEZWxpdmVyeS1naWYnKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBpZiAoY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWljb24nKSkgY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWljb24nKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBpZiAoIWZyZWVTaGlwcGluZ0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcudGFnLXNoaXBwaW5nJykpIHtcbiAgICAgICAgdmFyIHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgICAgdGFnLmNsYXNzTGlzdC5hZGQoJ3RhZy1zaGlwcGluZycpO1xuICAgICAgICB0YWcuY2xhc3NMaXN0LmFkZCgnbmV3LXRhZycpO1xuICAgICAgICB0YWcuaW5uZXJIVE1MID0gXCJGUkVURSBHUsOBVElTXCI7XG5cbiAgICAgICAgdmFyIGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnbnMtaWNvbicpO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ25zLWljb24tZnJlZS1zaGlwcGluZycpO1xuXG4gICAgICAgIGlmIChmcmVlU2hpcHBpbmdDb250YWluZXIpIHtcbiAgICAgICAgICBmcmVlU2hpcHBpbmdDb250YWluZXIuYXBwZW5kQ2hpbGQoaWNvbik7XG4gICAgICAgICAgZnJlZVNoaXBwaW5nQ29udGFpbmVyLmFwcGVuZENoaWxkKHRhZyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZyZWVTaGlwcGluZ0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcudGFnLXNoaXBwaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICBmcmVlU2hpcHBpbmdDb250YWluZXIucXVlcnlTZWxlY3RvcignLm5zLWljb24tZnJlZS1zaGlwcGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICAgIGZyZWVTaGlwcGluZ0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgfSBlbHNlIGlmICghZGF0YS5mcmVlU2hpcHBpbmcpIHtcbiAgICAgIGlmIChmcmVlU2hpcHBpbmdDb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgIFtdLm1hcC5jYWxsKGZyZWVTaGlwcGluZ0NvbnRhaW5lci5jaGlsZHJlbiwgZnVuY3Rpb24gKGVsZSkge1xuICAgICAgICAgIGVsZS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcm9wKSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ25zTG9hZGluZy5oaWRlJywgZG9jdW1lbnQuYm9keSk7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVybkNoZWNrZWRGcmVlU2hpcHBpbmcnLCBwcm9wLCBjb250ZW50LCBlbGVtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXBkYXRlTG9hZGluZ1N0YXRlKCk7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogQG1ldGhvZCBlcnJvclByb2R1Y3RcbiAgICogUmV0dXJuIGEgZnVsbCBjb250ZW50IGluIHByb2R1Y3QgcGFnZXMgd2hlbiBGUkVFU0hJUFBJTkcgQVBJIHJldHVybnMgNDA0XG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBlcnJvclByb2R1Y3QgPSBmdW5jdGlvbiAoY29udGVudCwgcHJvcCwgZWxlbWVudCkge1xuICAgIHZhciB0YWcgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktY29udGFpbmVyJyk7XG4gICAgaWYgKHRhZykge1xuICAgICAgaWYgKGNvbnRlbnQucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZycpKSB7XG4gICAgICAgIGNvbnRlbnQucXVlcnlTZWxlY3RvcignLnRhZy1zaGlwcGluZycpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgY29udGVudC5xdWVyeVNlbGVjdG9yKCcubnMtaWNvbi1mcmVlLXNoaXBwaW5nJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgfVxuICAgICAgaWYgKGNvbnRlbnQucXVlcnlTZWxlY3RvcignLmZyZWVEZWxpdmVyeS1naWYnKSkgY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWdpZicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIGlmIChjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktaWNvbicpKSBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktaWNvbicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIHRhZy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgfVxuICAgIFxuICAgIGlmIChwcm9wKSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ25zTG9hZGluZy5oaWRlJywgZG9jdW1lbnQuYm9keSk7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVybkNoZWNrZWRGcmVlU2hpcHBpbmcnLCBwcm9wLCBjb250ZW50LCBlbGVtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXBkYXRlTG9hZGluZ1N0YXRlKCk7XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgc3VjY2Vzc1F1aWNrVmlld1xuICAgKiBSZXR1cm4gYSBmdWxsIGNvbnRlbnQgaW4gc2VhcmNoIHBhZ2VzIGZvciBRdWlja1ZpZXcgY29udGVudCB3aGVuIEZSRUVTSElQUElORyBBUEkgcmV0dXJucyBzdWNjZXNzXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBzdWNjZXNzUXVpY2tWaWV3ID0gZnVuY3Rpb24gKGRhdGEsIGNvbnRlbnQpIHtcbiAgICB2YXIgZnJlZVNoaXBwaW5nQ29udGFpbmVyID0gY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpO1xuICAgIGlmICghZnJlZVNoaXBwaW5nQ29udGFpbmVyKSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVybkNoZWNrZWRGcmVlU2hpcHBpbmdRdWlja1ZpZXcnLCBjb250ZW50KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5mcmVlU2hpcHBpbmcpIHtcbiAgICAgIGlmIChjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktaWNvbicpKSBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5mcmVlRGVsaXZlcnktaWNvbicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcblxuICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgZWwuY2xhc3NMaXN0LmFkZCgndGFnLXNoaXBwaW5nJyk7XG4gICAgICBlbC5pbm5lckhUTUwgPSBcIkZSRVRFIEdSw4FUSVNcIjtcblxuICAgICAgdmFyIGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XG4gICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ25zLWljb24nKTtcbiAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnbnMtaWNvbi1mcmVlLXNoaXBwaW5nJyk7XG5cbiAgICAgIGlmIChmcmVlU2hpcHBpbmdDb250YWluZXIpIHtcbiAgICAgICAgZnJlZVNoaXBwaW5nQ29udGFpbmVyLmFwcGVuZENoaWxkKGljb24pO1xuICAgICAgICBmcmVlU2hpcHBpbmdDb250YWluZXIuYXBwZW5kQ2hpbGQoZWwpO1xuICAgICAgfVxuXG4gICAgICBmcmVlU2hpcHBpbmdDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIH0gZWxzZSBpZiAoIWRhdGEuZnJlZVNoaXBwaW5nKSB7XG4gICAgICBpZiAoZnJlZVNoaXBwaW5nQ29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICBbXS5tYXAuY2FsbChmcmVlU2hpcHBpbmdDb250YWluZXIuY2hpbGRyZW4sIGZ1bmN0aW9uIChlbGUpIHtcbiAgICAgICAgICBlbGUuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVybkNoZWNrZWRGcmVlU2hpcHBpbmdRdWlja1ZpZXcnLCBjb250ZW50KTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBlcnJvclF1aWNrVmlld1xuICAgKiBSZXR1cm4gYSBmdWxsIGNvbnRlbnQgaW4gc2VhcmNoIHBhZ2VzIGZvciBRdWlja1ZpZXcgY29udGVudCB3aGVuIEZSRUVTSElQUElORyBBUEkgcmV0dXJucyA0MDRcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIGVycm9yUXVpY2tWaWV3ID0gZnVuY3Rpb24gKGNvbnRlbnQpIHtcbiAgICB2YXIgdGFnID0gY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWNvbnRhaW5lcicpO1xuICAgIGlmICh0YWcpIHtcbiAgICAgIGlmIChjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy50YWctc2hpcHBpbmcnKSkge1xuICAgICAgICBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy50YWctc2hpcHBpbmcnKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIGNvbnRlbnQucXVlcnlTZWxlY3RvcignLm5zLWljb24tZnJlZS1zaGlwcGluZycpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0YWcuZmlyc3RDaGlsZEVsZW1lbnQgJiYgY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWljb24nKSkgY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZnJlZURlbGl2ZXJ5LWljb24nKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICB0YWcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIH1cblxuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YigncmV0dXJuQ2hlY2tlZEZyZWVTaGlwcGluZ1F1aWNrVmlldycsIGNvbnRlbnQpO1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdmVyaWZ5RnJlZVNoaXBwaW5nXG4gICAqIE1ha2UgdGhlIHJlcXVlc3QgZm9yIEZSRUVTSElQUElORyBBUEkgaW4gYWxsIGNhc2VzIChwZHAsIHNlYXJjaCwgcXVpY2t2aWV3KVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgdmVyaWZ5RnJlZVNoaXBwaW5nID0gZnVuY3Rpb24gKHNrdSwgc2VsbGVyLCB6aXBjb2RlLCBwcmljZSwgYmxvY2ssIGVsZW1lbnQpIHtcblxuICAgIHZhciBwYWdlID0gKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKS5jbGFzc0xpc3QuY29udGFpbnMoJ3Byb2R1Y3QtcGFnZScpKSA/ICdwcm9kdWN0JyA6ICdzZWFyY2gnLFxuICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIHN0b3JlSWQ6IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc3RvcmVJZCcpLFxuICAgICAgICAgIGNhbXBhaWduOiB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ2NhbXBhaWduQ29kZScpIHx8ICcnXG4gICAgICAgIH0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICBpZiAoKHBhZ2UgPT09ICdwcm9kdWN0JyB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGluZ2xlLW1vZGFsLS12aXNpYmxlJykpICYmICFwcmljZS5jbGFzc0xpc3QuY29udGFpbnMoJ2lzLXF1aWNrdmlldycpKSB7XG4gICAgICAgICAgICBzdWNjZXNzUHJvZHVjdChyZXMsIHByaWNlLCBibG9jaywgZWxlbWVudCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09PSAnc2VhcmNoJyAmJiAhcHJpY2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1xdWlja3ZpZXcnKSkge1xuICAgICAgICAgICAgc3VjY2Vzc1NlYXJjaChyZXMsIHByaWNlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHByaWNlLmNsYXNzTGlzdC5jb250YWlucygnaXMtcXVpY2t2aWV3JykpIHtcbiAgICAgICAgICAgIHN1Y2Nlc3NRdWlja1ZpZXcocmVzLCBwcmljZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChwYWdlID09PSAncHJvZHVjdCcgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbmdsZS1tb2RhbC0tdmlzaWJsZScpKSB7XG4gICAgICAgICAgICBlcnJvclByb2R1Y3QocHJpY2UsIGJsb2NrLCBlbGVtZW50KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT09ICdzZWFyY2gnICYmICFwcmljZS5jbGFzc0xpc3QuY29udGFpbnMoJ2lzLXF1aWNrdmlldycpICYmICFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGluZ2xlLW1vZGFsLS12aXNpYmxlJykpIHtcbiAgICAgICAgICAgIGVycm9yU2VhcmNoKHByaWNlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHByaWNlLmNsYXNzTGlzdC5jb250YWlucygnaXMtcXVpY2t2aWV3JykpIHtcbiAgICAgICAgICAgIGVycm9yUXVpY2tWaWV3KHByaWNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1cmwgPSAnL3Byb21vdGlvbi9zaGlwcGluZy8nICsgc2t1ICsgJy9zZWxsZXJzLycgKyBzZWxsZXIgKyAnL3ppcENvZGVzLycgKyB6aXBjb2RlO1xuXG4gICAgaWYgKHNrdSAmJiBzZWxsZXIgJiYgemlwY29kZSkge1xuICAgICAgd2luZG93LmZyZWVkb20ucmVzdENsaWVudC5yZXF1ZXN0KHVybCwgb3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwYWdlID09PSAncHJvZHVjdCcgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbmdsZS1tb2RhbC0tdmlzaWJsZScpKSB7XG4gICAgICAgIGVycm9yUHJvZHVjdChwcmljZSwgYmxvY2ssIGVsZW1lbnQpO1xuICAgICAgfSBlbHNlIGlmIChwYWdlID09PSAnc2VhcmNoJyAmJiAhcHJpY2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1xdWlja3ZpZXcnKSAmJiAhZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbmdsZS1tb2RhbC0tdmlzaWJsZScpKSB7XG4gICAgICAgIGVycm9yU2VhcmNoKHByaWNlKTtcbiAgICAgIH0gZWxzZSBpZiAocHJpY2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1xdWlja3ZpZXcnKSkge1xuICAgICAgICBlcnJvclF1aWNrVmlldyhwcmljZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHNldEVsaWdpYmlsaXR5Q29va2llXG4gICAqIFNldCBGcmVlc2hpcHBpbmcgcHJvbW90aW9uIGVsaWdpYmlsaXR5IGNvb2tpZVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgc2V0RWxpZ2liaWxpdHlDb29raWUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHZhciBlbGlnaWJsZSA9IChkYXRhICYmIGRhdGEuaGFzT3duUHJvcGVydHkoJ2VsaWdpYmxlJykpID8gZGF0YS5lbGlnaWJsZSA6ICcnO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9ICdmc2hpcEVsaWdpYmxlJyArICc9JyArIGVsaWdpYmxlICsgJzttYXgtYWdlPScgKyAoMiAqIDYwICogNjApICsgJztwYXRoPS8nO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1Yignc2hpcHBpbmdFbGlnaWJsZUNvb2tpZS5yZWluaXQnKTtcblxuICAgIGlmIChwYWdlVHlwZSA9PT0gJ3NlYXJjaCcpIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YigncmV0dXJuU2hpcHBpbmdFbGlnaWJpbGl0eS5MYXp5UHJpY2UnLCBlbGlnaWJsZSk7XG4gICAgfSBlbHNlIGlmIChwYWdlVHlwZSA9PT0gJ3Byb2R1Y3QnKSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3JldHVyblNoaXBwaW5nRWxpZ2liaWxpdHkuUERQJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVwZGF0ZUxvYWRpbmdTdGF0ZSgpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBjaGVja0VsaWdpYmlsaXR5XG4gICAqIE1ha2UgdGhlIHJlcXVlc3QgZm9yIEVMSUdJQkxFIEZSRUVTSElQUElORyBBUElcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIGNoZWNrRWxpZ2liaWxpdHkgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHZhciB6aXBjb2RlID0gZGF0YSB8fCB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3ppcGNvZGUnKTtcbiAgICBpZiAoIXppcGNvZGUpIHtcbiAgICAgIHNldEVsaWdpYmlsaXR5Q29va2llKG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIHN0b3JlSWQ6IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc3RvcmVJZCcpXG4gICAgICAgIH0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICB2YXIgcmVzcCA9IHJlcztcbiAgICAgICAgICBpZiAodHlwZW9mIHJlcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJlc3AgPSBKU09OLnBhcnNlKHJlcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNldEVsaWdpYmlsaXR5Q29va2llKHJlc3ApO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNldEVsaWdpYmlsaXR5Q29va2llKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdXJsID0gJy9wcm9tby9mcmVlc2hpcHBpbmcvJyArIHppcGNvZGUgKyAnL2VsaWdpYmlsaXR5JztcblxuICAgIHdpbmRvdy5mcmVlZG9tLnJlc3RDbGllbnQucmVxdWVzdCh1cmwsIG9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHNldFppcENvZGVcbiAgICogc2F2ZSBjb29raWUgemlwY29kZVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgc2V0WmlwQ29kZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdmFyIHppcGNvZGUgPSAoZGF0YSAmJiBkYXRhLmxlbmd0aCAmJiBkYXRhLmhhc093blByb3BlcnR5KCdhZGRyZXNzZXMnKSkgPyBkYXRhLmFkZHJlc3Nlc1swXS56aXBDb2RlIDogJyc7XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGRhdGUuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgMSk7XG4gICAgdmFyIGV4cGlyZXMgPSAnZXhwaXJlcz0nICsgZGF0ZS50b1VUQ1N0cmluZygpO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9ICd6aXBjb2RlJyArICc9JyArIHppcGNvZGUgKyAnOycgKyBleHBpcmVzICsgJztwYXRoPS8nO1xuXG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCd6aXBjb2RlQ29va2llLnJlaW5pdCcpO1xuXG4gICAgaWYgKHppcGNvZGUpIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignU2hpcHBpbmcucmVzdGFydCcpO1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdjaGFuZ2VIZWFkZXJaaXBjb2RlJywgemlwY29kZSk7XG4gICAgfVxuXG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdjaGVja0ZyZWVTaGlwcGluZ0VsaWdpYmlsaXR5JywgemlwY29kZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2hlY2tTb2Z0TG9naW5cbiAgICogTWFrZSB0aGUgcmVxdWVzdCBmb3IgRUxJR0lCTEUgRlJFRVNISVBQSU5HIEFQSVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgY2hlY2tTb2Z0TG9naW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgdHlwZTogJ2pzb24nLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgIHNldFppcENvZGUocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2V0WmlwQ29kZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgd2luZG93LmZyZWVkb20ucmVzdENsaWVudC5yZXF1ZXN0KCcvc29mdC1sb2dpbicsIG9wdGlvbnMpO1xuICB9O1xuXG4gIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignemlwY29kZUNvb2tpZS5yZWluaXQnLCByZWluaXRaaXBjb2RlQ29va2llKTtcbiAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdzaGlwcGluZ0VsaWdpYmxlQ29va2llLnJlaW5pdCcsIHJlaW5pdENvb2tpZVNoaXBwaW5nRWxpZ2libGUpO1xuXG4gIC8vIExpc3Rlcm5lcnMgZm9yIEFQSSBwcm9tb3Rpb24gc2hpcHBpbmcgYW5kIEVsaWdpYmxlIEFQSVxuICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3ZlcmlmeUZyZWVTaGlwcGluZycsIHZlcmlmeUZyZWVTaGlwcGluZyk7XG4gIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignY2hlY2tGcmVlU2hpcHBpbmdFbGlnaWJpbGl0eScsIGNoZWNrRWxpZ2liaWxpdHkpO1xuXG4gIGlmIChoYXNaaXBDb2RlQ29va2llICYmICFjb29raWVTaGlwcGluZ0VsaWdpYmxlKSB7XG4gICAgY2hlY2tFbGlnaWJpbGl0eShjb29raWVaaXBjb2RlKTtcbiAgfVxuICBpZiAoIWhhc0VsaWdpYmxlQ29va2llICYmICFoYXNaaXBDb2RlQ29va2llKSB7XG4gICAgY2hlY2tTb2Z0TG9naW4oKTtcbiAgfVxuXG59KHdpbmRvdywgd2luZG93LmRvY3VtZW50KSk7XG4iXX0=
